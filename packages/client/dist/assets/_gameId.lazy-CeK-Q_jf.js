import{r as ve,_ as dt,j as _,C as fa,d as ua,H as Xe,c as Ve,S as Zt,s as pt,t as yn,g as Pn,v as ca,F as Et,w as In,x as ha,y as Je,i as da,b as Er,z as jn,B as va,D as Mr,E as Gr,M as Nn,J as Rr,K as Br,O as Or,P as Lr,Q as Pr,R as Ir,h as Dt,T as kr,U as pa,V as ga,W as xn,f as ma,X as ya,Y as xa,Z as ba,l as Ua,G as Sa,$ as wa,a0 as _a,a1 as ka,a2 as Ta,a3 as Fa}from"./index-pAIMmDua.js";import{U as Ca,M as Aa,R as Da,a as Ea,b as Ma,c as jr,F as Ga,C as qt,V as vt,T as Tr,L as bn,I as Ra,d as Ba,e as Wn,f as Oa,D as zn,g as La,h as Un,i as Pa,j as Ia,k as ja,l as Nr,P as Wr,m as Na,n as Wa,u as Mt,s as za,o as zr,p as Vr,q as Va,r as Ha,t as Xa,v as Vn,S as Ya}from"./index-DnYxvVlF.js";function Ka(){var l=Object.create(null);function r(t,e){var a=t.id,o=t.name,n=t.dependencies;n===void 0&&(n=[]);var i=t.init;i===void 0&&(i=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!l[a])try{n=n.map(function(c){return c&&c.isWorkerModule&&(r(c,function(d){if(d instanceof Error)throw d}),c=l[c.id].value),c}),i=u("<"+o+">.init",i),s&&(s=u("<"+o+">.getTransferables",s));var f=null;typeof i=="function"?f=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),l[a]={id:a,value:f,getTransferables:s},e(f)}catch(c){c&&c.noLog||console.error(c),e(c)}}function h(t,e){var a,o=t.id,n=t.args;(!l[o]||typeof l[o].value!="function")&&e(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(a=l[o]).value.apply(a,n);i&&typeof i.then=="function"?i.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(i)}catch(f){e(f)}function s(f){try{var c=l[o].getTransferables&&l[o].getTransferables(f);(!c||!Array.isArray(c)||!c.length)&&(c=void 0),e(f,c)}catch(d){console.error(d),e(d)}}}function u(t,e){var a=void 0;self.troikaDefine=function(n){return a=n};var o=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(n){console.error(n)}return URL.revokeObjectURL(o),delete self.troikaDefine,a}self.addEventListener("message",function(t){var e=t.data,a=e.messageId,o=e.action,n=e.data;try{o==="registerModule"&&r(n,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),o==="callModule"&&h(n,function(i,s){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function Ja(l){var r=function(){for(var h=[],u=arguments.length;u--;)h[u]=arguments[u];return r._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,h);throw new Error("Worker module function was called but `init` did not return a callable function")})};return r._getInitResult=function(){var h=l.dependencies,u=l.init;h=Array.isArray(h)?h.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[];var t=Promise.all(h).then(function(e){return u.apply(null,e)});return r._getInitResult=function(){return t},t},r}var Hn=function(){var l=!1;if(typeof window<"u"&&typeof window.document<"u")try{var r=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));r.terminate(),l=!0}catch(h){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+h.message+"]")}return Hn=function(){return l},l},Qa=0,Za=0,br=!1,Ct=Object.create(null),At=Object.create(null),Fr=Object.create(null);function gt(l){if((!l||typeof l.init!="function")&&!br)throw new Error("requires `options.init` function");var r=l.dependencies,h=l.init,u=l.getTransferables,t=l.workerId;if(!Hn())return Ja(l);t==null&&(t="#default");var e="workerModule"+ ++Qa,a=l.name||e,o=null;r=r&&r.map(function(i){return typeof i=="function"&&!i.workerModuleData&&(br=!0,i=gt({workerId:t,name:"<"+a+"> function dependency: "+i.name,init:`function(){return (
`+Jt(i)+`
)}`}),br=!1),i&&i.workerModuleData&&(i=i.workerModuleData),i});function n(){for(var i=[],s=arguments.length;s--;)i[s]=arguments[s];if(!o){o=Sn(t,"registerModule",n.workerModuleData);var f=function(){o=null,At[t].delete(f)};(At[t]||(At[t]=new Set)).add(f)}return o.then(function(c){var d=c.isCallable;if(d)return Sn(t,"callModule",{id:e,args:i});throw new Error("Worker module function was called but `init` did not return a callable function")})}return n.workerModuleData={isWorkerModule:!0,id:e,name:a,dependencies:r,init:Jt(h),getTransferables:u&&Jt(u)},n}function qa(l){At[l]&&At[l].forEach(function(r){r()}),Ct[l]&&(Ct[l].terminate(),delete Ct[l])}function Jt(l){var r=l.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function $a(l){var r=Ct[l];if(!r){var h=Jt(Ka);r=Ct[l]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+l.replace(/\*/g,"")+` **/

;(`+h+")()"],{type:"application/javascript"}))),r.onmessage=function(u){var t=u.data,e=t.messageId,a=Fr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Fr[e],a(t)}}return r}function Sn(l,r,h){return new Promise(function(u,t){var e=++Za;Fr[e]=function(a){a.success?u(a.result):t(new Error("Error in worker "+r+" call: "+a.error))},$a(l).postMessage({messageId:e,action:r,data:h})})}function Xn(){var l=function(r){function h(P,G,v,x,k,D,U,N){var M=1-U;N.x=M*M*P+2*M*U*v+U*U*k,N.y=M*M*G+2*M*U*x+U*U*D}function u(P,G,v,x,k,D,U,N,M,I){var Y=1-M;I.x=Y*Y*Y*P+3*Y*Y*M*v+3*Y*M*M*k+M*M*M*U,I.y=Y*Y*Y*G+3*Y*Y*M*x+3*Y*M*M*D+M*M*M*N}function t(P,G){for(var v=/([MLQCZ])([^MLQCZ]*)/g,x,k,D,U,N;x=v.exec(P);){var M=x[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(I){return parseFloat(I)});switch(x[1]){case"M":U=k=M[0],N=D=M[1];break;case"L":(M[0]!==U||M[1]!==N)&&G("L",U,N,U=M[0],N=M[1]);break;case"Q":{G("Q",U,N,U=M[2],N=M[3],M[0],M[1]);break}case"C":{G("C",U,N,U=M[4],N=M[5],M[0],M[1],M[2],M[3]);break}case"Z":(U!==k||N!==D)&&G("L",U,N,k,D);break}}}function e(P,G,v){v===void 0&&(v=16);var x={x:0,y:0};t(P,function(k,D,U,N,M,I,Y,ee,H){switch(k){case"L":G(D,U,N,M);break;case"Q":{for(var W=D,me=U,ce=1;ce<v;ce++)h(D,U,I,Y,N,M,ce/(v-1),x),G(W,me,x.x,x.y),W=x.x,me=x.y;break}case"C":{for(var Z=D,te=U,le=1;le<v;le++)u(D,U,I,Y,ee,H,N,M,le/(v-1),x),G(Z,te,x.x,x.y),Z=x.x,te=x.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(P,G){var v=P.getContext?P.getContext("webgl",i):P,x=n.get(v);if(!x){let Y=function(Z){var te=D[Z];if(!te&&(te=D[Z]=v.getExtension(Z),!te))throw new Error(Z+" not supported");return te},ee=function(Z,te){var le=v.createShader(te);return v.shaderSource(le,Z),v.compileShader(le),le},H=function(Z,te,le,V){if(!U[Z]){var re={},$={},L=v.createProgram();v.attachShader(L,ee(te,v.VERTEX_SHADER)),v.attachShader(L,ee(le,v.FRAGMENT_SHADER)),v.linkProgram(L),U[Z]={program:L,transaction:function(Q){v.useProgram(L),Q({setUniform:function(K,Ue){for(var ae=[],ie=arguments.length-2;ie-- >0;)ae[ie]=arguments[ie+2];var ue=$[Ue]||($[Ue]=v.getUniformLocation(L,Ue));v["uniform"+K].apply(v,[ue].concat(ae))},setAttribute:function(K,Ue,ae,ie,ue){var pe=re[K];pe||(pe=re[K]={buf:v.createBuffer(),loc:v.getAttribLocation(L,K),data:null}),v.bindBuffer(v.ARRAY_BUFFER,pe.buf),v.vertexAttribPointer(pe.loc,Ue,v.FLOAT,!1,0,0),v.enableVertexAttribArray(pe.loc),k?v.vertexAttribDivisor(pe.loc,ie):Y("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(pe.loc,ie),ue!==pe.data&&(v.bufferData(v.ARRAY_BUFFER,ue,ae),pe.data=ue)}})}}}U[Z].transaction(V)},W=function(Z,te){M++;try{v.activeTexture(v.TEXTURE0+M);var le=N[Z];le||(le=N[Z]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,le),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,le),te(le,M)}finally{M--}},me=function(Z,te,le){var V=v.createFramebuffer();I.push(V),v.bindFramebuffer(v.FRAMEBUFFER,V),v.activeTexture(v.TEXTURE0+te),v.bindTexture(v.TEXTURE_2D,Z),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,Z,0);try{le(V)}finally{v.deleteFramebuffer(V),v.bindFramebuffer(v.FRAMEBUFFER,I[--I.length-1]||null)}},ce=function(){D={},U={},N={},M=-1,I.length=0};var k=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,D={},U={},N={},M=-1,I=[];v.canvas.addEventListener("webglcontextlost",function(Z){ce(),Z.preventDefault()},!1),n.set(v,x={gl:v,isWebGL2:k,getExtension:Y,withProgram:H,withTexture:W,withTextureFramebuffer:me,handleContextLoss:ce})}G(x)}function f(P,G,v,x,k,D,U,N){U===void 0&&(U=15),N===void 0&&(N=null),s(P,function(M){var I=M.gl,Y=M.withProgram,ee=M.withTexture;ee("copy",function(H,W){I.texImage2D(I.TEXTURE_2D,0,I.RGBA,k,D,0,I.RGBA,I.UNSIGNED_BYTE,G),Y("copy",a,o,function(me){var ce=me.setUniform,Z=me.setAttribute;Z("aUV",2,I.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",W),I.bindFramebuffer(I.FRAMEBUFFER,N||null),I.disable(I.BLEND),I.colorMask(U&8,U&4,U&2,U&1),I.viewport(v,x,k,D),I.scissor(v,x,k,D),I.drawArrays(I.TRIANGLES,0,3)})})})}function c(P,G,v){var x=P.width,k=P.height;s(P,function(D){var U=D.gl,N=new Uint8Array(x*k*4);U.readPixels(0,0,x,k,U.RGBA,U.UNSIGNED_BYTE,N),P.width=G,P.height=v,f(U,N,0,0,x,k)})}var d=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:c});function p(P,G,v,x,k,D){D===void 0&&(D=1);var U=new Uint8Array(P*G),N=x[2]-x[0],M=x[3]-x[1],I=[];e(v,function(Z,te,le,V){I.push({x1:Z,y1:te,x2:le,y2:V,minX:Math.min(Z,le),minY:Math.min(te,V),maxX:Math.max(Z,le),maxY:Math.max(te,V)})}),I.sort(function(Z,te){return Z.maxX-te.maxX});for(var Y=0;Y<P;Y++)for(var ee=0;ee<G;ee++){var H=me(x[0]+N*(Y+.5)/P,x[1]+M*(ee+.5)/G),W=Math.pow(1-Math.abs(H)/k,D)/2;H<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),U[ee*P+Y]=W}return U;function me(Z,te){for(var le=1/0,V=1/0,re=I.length;re--;){var $=I[re];if($.maxX+V<=Z)break;if(Z+V>$.minX&&te-V<$.maxY&&te+V>$.minY){var L=B(Z,te,$.x1,$.y1,$.x2,$.y2);L<le&&(le=L,V=Math.sqrt(le))}}return ce(Z,te)&&(V=-V),V}function ce(Z,te){for(var le=0,V=I.length;V--;){var re=I[V];if(re.maxX<=Z)break;var $=re.y1>te!=re.y2>te&&Z<(re.x2-re.x1)*(te-re.y1)/(re.y2-re.y1)+re.x1;$&&(le+=re.y1<re.y2?1:-1)}return le!==0}}function g(P,G,v,x,k,D,U,N,M,I){D===void 0&&(D=1),N===void 0&&(N=0),M===void 0&&(M=0),I===void 0&&(I=0),m(P,G,v,x,k,D,U,null,N,M,I)}function m(P,G,v,x,k,D,U,N,M,I,Y){D===void 0&&(D=1),M===void 0&&(M=0),I===void 0&&(I=0),Y===void 0&&(Y=0);for(var ee=p(P,G,v,x,k,D),H=new Uint8Array(ee.length*4),W=0;W<ee.length;W++)H[W*4+Y]=ee[W];f(U,H,M,I,P,G,1<<3-Y,N)}function B(P,G,v,x,k,D){var U=k-v,N=D-x,M=U*U+N*N,I=M?Math.max(0,Math.min(1,((P-v)*U+(G-x)*N)/M)):0,Y=P-(v+I*U),ee=G-(x+I*N);return Y*Y+ee*ee}var S=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:g,generateIntoFramebuffer:m}),T="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",F="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",O=new Float32Array([0,0,2,0,0,2]),w=null,A=!1,j={},R=new WeakMap;function J(P){if(!A&&!X(P))throw new Error("WebGL generation not supported")}function y(P,G,v,x,k,D,U){if(D===void 0&&(D=1),U===void 0&&(U=null),!U&&(U=w,!U)){var N=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!N)throw new Error("OffscreenCanvas or DOM canvas not supported");U=w=N.getContext("webgl",{depth:!1})}J(U);var M=new Uint8Array(P*G*4);s(U,function(H){var W=H.gl,me=H.withTexture,ce=H.withTextureFramebuffer;me("readable",function(Z,te){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,P,G,0,W.RGBA,W.UNSIGNED_BYTE,null),ce(Z,te,function(le){C(P,G,v,x,k,D,W,le,0,0,0),W.readPixels(0,0,P,G,W.RGBA,W.UNSIGNED_BYTE,M)})})});for(var I=new Uint8Array(P*G),Y=0,ee=0;Y<M.length;Y+=4)I[ee++]=M[Y];return I}function E(P,G,v,x,k,D,U,N,M,I){D===void 0&&(D=1),N===void 0&&(N=0),M===void 0&&(M=0),I===void 0&&(I=0),C(P,G,v,x,k,D,U,null,N,M,I)}function C(P,G,v,x,k,D,U,N,M,I,Y){D===void 0&&(D=1),M===void 0&&(M=0),I===void 0&&(I=0),Y===void 0&&(Y=0),J(U);var ee=[];e(v,function(H,W,me,ce){ee.push(H,W,me,ce)}),ee=new Float32Array(ee),s(U,function(H){var W=H.gl,me=H.isWebGL2,ce=H.getExtension,Z=H.withProgram,te=H.withTexture,le=H.withTextureFramebuffer,V=H.handleContextLoss;if(te("rawDistances",function(re,$){(P!==re._lastWidth||G!==re._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,re._lastWidth=P,re._lastHeight=G,0,W.RGBA,W.UNSIGNED_BYTE,null),Z("main",T,b,function(L){var de=L.setAttribute,Q=L.setUniform,oe=!me&&ce("ANGLE_instanced_arrays"),K=!me&&ce("EXT_blend_minmax");de("aUV",2,W.STATIC_DRAW,0,O),de("aLineSegment",4,W.DYNAMIC_DRAW,1,ee),Q.apply(void 0,["4f","uGlyphBounds"].concat(x)),Q("1f","uMaxDistance",k),Q("1f","uExponent",D),le(re,$,function(Ue){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,P,G),W.scissor(0,0,P,G),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,me?W.MAX:K.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),me?W.drawArraysInstanced(W.TRIANGLES,0,3,ee.length/4):oe.drawArraysInstancedANGLE(W.TRIANGLES,0,3,ee.length/4)})}),Z("post",a,F,function(L){L.setAttribute("aUV",2,W.STATIC_DRAW,0,O),L.setUniform("1i","tex",$),W.bindFramebuffer(W.FRAMEBUFFER,N),W.disable(W.BLEND),W.colorMask(Y===0,Y===1,Y===2,Y===3),W.viewport(M,I,P,G),W.scissor(M,I,P,G),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw V(),new Error("webgl context lost")})}function X(P){var G=!P||P===w?j:P.canvas||P,v=R.get(G);if(v===void 0){A=!0;var x=null;try{var k=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],D=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);v=D&&k.length===D.length&&D.every(function(U,N){return U===k[N]}),v||(x="bad trial run results",console.info(k,D))}catch(U){v=!1,x=U.message}x&&console.warn("WebGL SDF generation not supported:",x),A=!1,R.set(G,v)}return v}var z=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:E,generateIntoFramebuffer:C,isSupported:X});function q(P,G,v,x,k,D){k===void 0&&(k=Math.max(x[2]-x[0],x[3]-x[1])/2),D===void 0&&(D=1);try{return y.apply(z,arguments)}catch(U){return console.info("WebGL SDF generation failed, falling back to JS",U),p.apply(S,arguments)}}function ne(P,G,v,x,k,D,U,N,M,I){k===void 0&&(k=Math.max(x[2]-x[0],x[3]-x[1])/2),D===void 0&&(D=1),N===void 0&&(N=0),M===void 0&&(M=0),I===void 0&&(I=0);try{return E.apply(z,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),g.apply(S,arguments)}}return r.forEachPathCommand=t,r.generate=q,r.generateIntoCanvas=ne,r.javascript=S,r.pathToLineSegments=e,r.webgl=z,r.webglUtils=d,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}function eo(){var l=function(r){var h={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},u={},t={};u.L=1,t[1]="L",Object.keys(h).forEach(function(V,re){u[V]=1<<re+1,t[u[V]]=V}),Object.freeze(u);var e=u.LRI|u.RLI|u.FSI,a=u.L|u.R|u.AL,o=u.B|u.S|u.WS|u.ON|u.FSI|u.LRI|u.RLI|u.PDI,n=u.BN|u.RLE|u.LRE|u.RLO|u.LRO|u.PDF,i=u.S|u.WS|u.B|e|u.PDI|n,s=null;function f(){if(!s){s=new Map;var V=function($){if(h.hasOwnProperty($)){var L=0;h[$].split(",").forEach(function(de){var Q=de.split("+"),oe=Q[0],K=Q[1];oe=parseInt(oe,36),K=K?parseInt(K,36):0,s.set(L+=oe,u[$]);for(var Ue=0;Ue<K;Ue++)s.set(++L,u[$])})}};for(var re in h)V(re)}}function c(V){return f(),s.get(V.codePointAt(0))||u.L}function d(V){return t[c(V)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(V,re){var $=36,L=0,de=new Map,Q=re&&new Map,oe;return V.split(",").forEach(function K(Ue){if(Ue.indexOf("+")!==-1)for(var ae=+Ue;ae--;)K(oe);else{oe=Ue;var ie=Ue.split(">"),ue=ie[0],pe=ie[1];ue=String.fromCodePoint(L+=parseInt(ue,$)),pe=String.fromCodePoint(L+=parseInt(pe,$)),de.set(ue,pe),re&&Q.set(pe,ue)}}),{map:de,reverseMap:Q}}var m,B,S;function T(){if(!m){var V=g(p.pairs,!0),re=V.map,$=V.reverseMap;m=re,B=$,S=g(p.canonical,!1).map}}function b(V){return T(),m.get(V)||null}function F(V){return T(),B.get(V)||null}function O(V){return T(),S.get(V)||null}var w=u.L,A=u.R,j=u.EN,R=u.ES,J=u.ET,y=u.AN,E=u.CS,C=u.B,X=u.S,z=u.ON,q=u.BN,ne=u.NSM,P=u.AL,G=u.LRO,v=u.RLO,x=u.LRE,k=u.RLE,D=u.PDF,U=u.LRI,N=u.RLI,M=u.FSI,I=u.PDI;function Y(V,re){for(var $=125,L=new Uint32Array(V.length),de=0;de<V.length;de++)L[de]=c(V[de]);var Q=new Map;function oe(Pe,ze){var Ie=L[Pe];L[Pe]=ze,Q.set(Ie,Q.get(Ie)-1),Ie&o&&Q.set(o,Q.get(o)-1),Q.set(ze,(Q.get(ze)||0)+1),ze&o&&Q.set(o,(Q.get(o)||0)+1)}for(var K=new Uint8Array(V.length),Ue=new Map,ae=[],ie=null,ue=0;ue<V.length;ue++)ie||ae.push(ie={start:ue,end:V.length-1,level:re==="rtl"?1:re==="ltr"?0:gn(ue,!1)}),L[ue]&C&&(ie.end=ue,ie=null);for(var pe=k|x|v|G|e|I|D|C,_e=function(Pe){return Pe+(Pe&1?1:2)},Ae=function(Pe){return Pe+(Pe&1?2:1)},ye=0;ye<ae.length;ye++){ie=ae[ye];var xe=[{_level:ie.level,_override:0,_isolate:0}],fe=void 0,De=0,Te=0,Le=0;Q.clear();for(var ke=ie.start;ke<=ie.end;ke++){var he=L[ke];if(fe=xe[xe.length-1],Q.set(he,(Q.get(he)||0)+1),he&o&&Q.set(o,(Q.get(o)||0)+1),he&pe)if(he&(k|x)){K[ke]=fe._level;var Se=(he===k?Ae:_e)(fe._level);Se<=$&&!De&&!Te?xe.push({_level:Se,_override:0,_isolate:0}):De||Te++}else if(he&(v|G)){K[ke]=fe._level;var Qe=(he===v?Ae:_e)(fe._level);Qe<=$&&!De&&!Te?xe.push({_level:Qe,_override:he&v?A:w,_isolate:0}):De||Te++}else if(he&e){he&M&&(he=gn(ke+1,!0)===1?N:U),K[ke]=fe._level,fe._override&&oe(ke,fe._override);var we=(he===N?Ae:_e)(fe._level);we<=$&&De===0&&Te===0?(Le++,xe.push({_level:we,_override:0,_isolate:1,_isolInitIndex:ke})):De++}else if(he&I){if(De>0)De--;else if(Le>0){for(Te=0;!xe[xe.length-1]._isolate;)xe.pop();var be=xe[xe.length-1]._isolInitIndex;be!=null&&(Ue.set(be,ke),Ue.set(ke,be)),xe.pop(),Le--}fe=xe[xe.length-1],K[ke]=fe._level,fe._override&&oe(ke,fe._override)}else he&D?(De===0&&(Te>0?Te--:!fe._isolate&&xe.length>1&&(xe.pop(),fe=xe[xe.length-1])),K[ke]=fe._level):he&C&&(K[ke]=ie.level);else K[ke]=fe._level,fe._override&&he!==q&&oe(ke,fe._override)}for(var Ee=[],Fe=null,ge=ie.start;ge<=ie.end;ge++){var Ce=L[ge];if(!(Ce&n)){var Be=K[ge],Re=Ce&e,Me=Ce===I;Fe&&Be===Fe._level?(Fe._end=ge,Fe._endsWithIsolInit=Re):Ee.push(Fe={_start:ge,_end:ge,_level:Be,_startsWithPDI:Me,_endsWithIsolInit:Re})}}for(var Ne=[],Ze=0;Ze<Ee.length;Ze++){var Ye=Ee[Ze];if(!Ye._startsWithPDI||Ye._startsWithPDI&&!Ue.has(Ye._start)){for(var qe=[Fe=Ye],tt=void 0;Fe&&Fe._endsWithIsolInit&&(tt=Ue.get(Fe._end))!=null;)for(var Ke=Ze+1;Ke<Ee.length;Ke++)if(Ee[Ke]._start===tt){qe.push(Fe=Ee[Ke]);break}for(var Oe=[],rt=0;rt<qe.length;rt++)for(var Jr=qe[rt],er=Jr._start;er<=Jr._end;er++)Oe.push(er);for(var na=K[Oe[0]],Qr=ie.level,Gt=Oe[0]-1;Gt>=0;Gt--)if(!(L[Gt]&n)){Qr=K[Gt];break}var tr=Oe[Oe.length-1],aa=K[tr],Zr=ie.level;if(!(L[tr]&e)){for(var Rt=tr+1;Rt<=ie.end;Rt++)if(!(L[Rt]&n)){Zr=K[Rt];break}}Ne.push({_seqIndices:Oe,_sosType:Math.max(Qr,na)%2?A:w,_eosType:Math.max(Zr,aa)%2?A:w})}}for(var rr=0;rr<Ne.length;rr++){var nr=Ne[rr],se=nr._seqIndices,mt=nr._sosType,oa=nr._eosType,it=K[se[0]]&1?A:w;if(Q.get(ne))for(var Bt=0;Bt<se.length;Bt++){var qr=se[Bt];if(L[qr]&ne){for(var ar=mt,Ot=Bt-1;Ot>=0;Ot--)if(!(L[se[Ot]]&n)){ar=L[se[Ot]];break}oe(qr,ar&(e|I)?z:ar)}}if(Q.get(j))for(var Lt=0;Lt<se.length;Lt++){var $r=se[Lt];if(L[$r]&j)for(var Pt=Lt-1;Pt>=-1;Pt--){var en=Pt===-1?mt:L[se[Pt]];if(en&a){en===P&&oe($r,y);break}}}if(Q.get(P))for(var or=0;or<se.length;or++){var tn=se[or];L[tn]&P&&oe(tn,A)}if(Q.get(R)||Q.get(E))for(var yt=1;yt<se.length-1;yt++){var ir=se[yt];if(L[ir]&(R|E)){for(var st=0,sr=0,lr=yt-1;lr>=0&&(st=L[se[lr]],!!(st&n));lr--);for(var fr=yt+1;fr<se.length&&(sr=L[se[fr]],!!(sr&n));fr++);st===sr&&(L[ir]===R?st===j:st&(j|y))&&oe(ir,st)}}if(Q.get(j))for(var He=0;He<se.length;He++){var ia=se[He];if(L[ia]&j){for(var It=He-1;It>=0&&L[se[It]]&(J|n);It--)oe(se[It],j);for(He++;He<se.length&&L[se[He]]&(J|n|j);He++)L[se[He]]!==j&&oe(se[He],j)}}if(Q.get(J)||Q.get(R)||Q.get(E))for(var xt=0;xt<se.length;xt++){var rn=se[xt];if(L[rn]&(J|R|E)){oe(rn,z);for(var jt=xt-1;jt>=0&&L[se[jt]]&n;jt--)oe(se[jt],z);for(var Nt=xt+1;Nt<se.length&&L[se[Nt]]&n;Nt++)oe(se[Nt],z)}}if(Q.get(j))for(var ur=0,nn=mt;ur<se.length;ur++){var an=se[ur],cr=L[an];cr&j?nn===w&&oe(an,w):cr&a&&(nn=cr)}if(Q.get(o)){var bt=A|j|y,on=bt|w,Wt=[];{for(var lt=[],ft=0;ft<se.length;ft++)if(L[se[ft]]&o){var Ut=V[se[ft]],sn=void 0;if(b(Ut)!==null)if(lt.length<63)lt.push({char:Ut,seqIndex:ft});else break;else if((sn=F(Ut))!==null)for(var St=lt.length-1;St>=0;St--){var hr=lt[St].char;if(hr===sn||hr===F(O(Ut))||b(O(hr))===Ut){Wt.push([lt[St].seqIndex,ft]),lt.length=St;break}}}Wt.sort(function(Pe,ze){return Pe[0]-ze[0]})}for(var dr=0;dr<Wt.length;dr++){for(var ln=Wt[dr],zt=ln[0],vr=ln[1],fn=!1,We=0,pr=zt+1;pr<vr;pr++){var un=se[pr];if(L[un]&on){fn=!0;var cn=L[un]&bt?A:w;if(cn===it){We=cn;break}}}if(fn&&!We){We=mt;for(var gr=zt-1;gr>=0;gr--){var hn=se[gr];if(L[hn]&on){var dn=L[hn]&bt?A:w;dn!==it?We=dn:We=it;break}}}if(We){if(L[se[zt]]=L[se[vr]]=We,We!==it){for(var wt=zt+1;wt<se.length;wt++)if(!(L[se[wt]]&n)){c(V[se[wt]])&ne&&(L[se[wt]]=We);break}}if(We!==it){for(var _t=vr+1;_t<se.length;_t++)if(!(L[se[_t]]&n)){c(V[se[_t]])&ne&&(L[se[_t]]=We);break}}}}for(var $e=0;$e<se.length;$e++)if(L[se[$e]]&o){for(var vn=$e,mr=$e,yr=mt,kt=$e-1;kt>=0;kt--)if(L[se[kt]]&n)vn=kt;else{yr=L[se[kt]]&bt?A:w;break}for(var pn=oa,Tt=$e+1;Tt<se.length;Tt++)if(L[se[Tt]]&(o|n))mr=Tt;else{pn=L[se[Tt]]&bt?A:w;break}for(var xr=vn;xr<=mr;xr++)L[se[xr]]=yr===pn?yr:it;$e=mr}}}for(var je=ie.start;je<=ie.end;je++){var sa=K[je],Vt=L[je];if(sa&1?Vt&(w|j|y)&&K[je]++:Vt&A?K[je]++:Vt&(y|j)&&(K[je]+=2),Vt&n&&(K[je]=je===0?ie.level:K[je-1]),je===ie.end||c(V[je])&(X|C))for(var Ht=je;Ht>=0&&c(V[Ht])&i;Ht--)K[Ht]=ie.level}}return{levels:K,paragraphs:ae};function gn(Pe,ze){for(var Ie=Pe;Ie<V.length;Ie++){var et=L[Ie];if(et&(A|P))return 1;if(et&(C|w)||ze&&et===I)return 0;if(et&e){var mn=la(Ie);Ie=mn===-1?V.length:mn}}return 0}function la(Pe){for(var ze=1,Ie=Pe+1;Ie<V.length;Ie++){var et=L[Ie];if(et&C)break;if(et&I){if(--ze===0)return Ie}else et&e&&ze++}return-1}}var ee="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",H;function W(){if(!H){var V=g(ee,!0),re=V.map,$=V.reverseMap;$.forEach(function(L,de){re.set(de,L)}),H=re}}function me(V){return W(),H.get(V)||null}function ce(V,re,$,L){var de=V.length;$=Math.max(0,$==null?0:+$),L=Math.min(de-1,L==null?de-1:+L);for(var Q=new Map,oe=$;oe<=L;oe++)if(re[oe]&1){var K=me(V[oe]);K!==null&&Q.set(oe,K)}return Q}function Z(V,re,$,L){var de=V.length;$=Math.max(0,$==null?0:+$),L=Math.min(de-1,L==null?de-1:+L);var Q=[];return re.paragraphs.forEach(function(oe){var K=Math.max($,oe.start),Ue=Math.min(L,oe.end);if(K<Ue){for(var ae=re.levels.slice(K,Ue+1),ie=Ue;ie>=K&&c(V[ie])&i;ie--)ae[ie]=oe.level;for(var ue=oe.level,pe=1/0,_e=0;_e<ae.length;_e++){var Ae=ae[_e];Ae>ue&&(ue=Ae),Ae<pe&&(pe=Ae|1)}for(var ye=ue;ye>=pe;ye--)for(var xe=0;xe<ae.length;xe++)if(ae[xe]>=ye){for(var fe=xe;xe+1<ae.length&&ae[xe+1]>=ye;)xe++;xe>fe&&Q.push([fe+K,xe+K])}}}),Q}function te(V,re,$,L){var de=le(V,re,$,L),Q=[].concat(V);return de.forEach(function(oe,K){Q[K]=(re.levels[oe]&1?me(V[oe]):null)||V[oe]}),Q.join("")}function le(V,re,$,L){for(var de=Z(V,re,$,L),Q=[],oe=0;oe<V.length;oe++)Q[oe]=oe;return de.forEach(function(K){for(var Ue=K[0],ae=K[1],ie=Q.slice(Ue,ae+1),ue=ie.length;ue--;)Q[ae-ue]=ie[ue]}),Q}return r.closingToOpeningBracket=F,r.getBidiCharType=c,r.getBidiCharTypeName=d,r.getCanonicalBracket=O,r.getEmbeddingLevels=Y,r.getMirroredCharacter=me,r.getMirroredCharactersMap=ce,r.getReorderSegments=Z,r.getReorderedIndices=le,r.getReorderedString=te,r.openingToClosingBracket=b,Object.defineProperty(r,"__esModule",{value:!0}),r}({});return l}const Yn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Cr(l){const r=/^[ \t]*#include +<([\w\d./]+)>/gm;function h(u,t){let e=Ma[t];return e?Cr(e):u}return l.replace(r,h)}const Ge=[];for(let l=0;l<256;l++)Ge[l]=(l<16?"0":"")+l.toString(16);function to(){const l=Math.random()*4294967295|0,r=Math.random()*4294967295|0,h=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Ge[l&255]+Ge[l>>8&255]+Ge[l>>16&255]+Ge[l>>24&255]+"-"+Ge[r&255]+Ge[r>>8&255]+"-"+Ge[r>>16&15|64]+Ge[r>>24&255]+"-"+Ge[h&63|128]+Ge[h>>8&255]+"-"+Ge[h>>16&255]+Ge[h>>24&255]+Ge[u&255]+Ge[u>>8&255]+Ge[u>>16&255]+Ge[u>>24&255]).toUpperCase()}const nt=Object.assign||function(){let l=arguments[0];for(let r=1,h=arguments.length;r<h;r++){let u=arguments[r];if(u)for(let t in u)Object.prototype.hasOwnProperty.call(u,t)&&(l[t]=u[t])}return l},ro=Date.now(),wn=new WeakMap,_n=new Map;let no=1e10;function Ar(l,r){const h=so(r);let u=wn.get(l);if(u||wn.set(l,u=Object.create(null)),u[h])return new u[h];const t=`_onBeforeCompile${h}`,e=function(i,s){l.onBeforeCompile.call(this,i,s);const f=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let c=_n[f];if(!c){const d=ao(this,i,r,h);c=_n[f]=d}i.vertexShader=c.vertexShader,i.fragmentShader=c.fragmentShader,nt(i.uniforms,this.uniforms),r.timeUniform&&(i.uniforms[r.timeUniform]={get value(){return Date.now()-ro}}),this[t]&&this[t](i)},a=function(){return o(r.chained?l:l.clone())},o=function(i){const s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:l}),Object.defineProperty(s,"id",{value:no++}),s.uuid=to(),s.uniforms=nt({},i.uniforms,r.uniforms),s.defines=nt({},i.defines,r.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${h}`]="",s.extensions=nt({},i.extensions,r.extensions),s._listeners=void 0,s},n={constructor:{value:a},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return l.customProgramCacheKey()+"|"+h}},onBeforeCompile:{get(){return e},set(i){this[t]=i}},copy:{writable:!0,configurable:!0,value:function(i){return l.copy.call(this,i),!l.isShaderMaterial&&!l.isDerivedMaterial&&(nt(this.extensions,i.extensions),nt(this.defines,i.defines),nt(this.uniforms,Ca.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new l.constructor;return o(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=Ar(l.isDerivedMaterial?l.getDepthMaterial():new Aa({depthPacking:Da}),r),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=Ar(l.isDerivedMaterial?l.getDistanceMaterial():new Ea,r),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),l.dispose.call(this)}}};return u[h]=a,new a}function ao(l,{vertexShader:r,fragmentShader:h},u,t){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:o,vertexTransform:n,fragmentDefs:i,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:c,customRewriter:d,timeUniform:p}=u;if(e=e||"",a=a||"",o=o||"",i=i||"",s=s||"",f=f||"",(n||d)&&(r=Cr(r)),(c||d)&&(h=h.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),h=Cr(h)),d){let g=d({vertexShader:r,fragmentShader:h});r=g.vertexShader,h=g.fragmentShader}if(c){let g=[];h=h.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(g.push(m),"")),f=`${c}
${g.join(`
`)}
${f}`}if(p){const g=`
uniform float ${p};
`;e=g+e,i=g+i}return n&&(r=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${r}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,a=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${a}
`,r=r.replace(/\b(position|normal|uv)\b/g,(g,m,B,S)=>/\battribute\s+vec[23]\s+$/.test(S.substr(0,B))?m:`troika_${m}_${t}`),l.map&&l.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),r=kn(r,t,e,a,o),h=kn(h,t,i,s,f),{vertexShader:r,fragmentShader:h}}function kn(l,r,h,u,t){return(u||t||h)&&(l=l.replace(Yn,`
${h}
void troikaOrigMain${r}() {`),l+=`
void main() {
  ${u}
  troikaOrigMain${r}();
  ${t}
}`),l}function oo(l,r){return l==="uniforms"?void 0:typeof r=="function"?r.toString():r}let io=0;const Tn=new Map;function so(l){const r=JSON.stringify(l,oo);let h=Tn.get(r);return h==null&&Tn.set(r,h=++io),h}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function lo(){return typeof window>"u"&&(self.window=self),function(l){var r={parse:function(t){var e=r._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var o=4;e.readUshort(a,o),o+=2,e.readUshort(a,o),o+=2;var n=e.readUint(a,o);o+=4;for(var i=[],s=0;s<n;s++){var f=e.readUint(a,o);o+=4,i.push(r._readFont(a,f))}return i}return[r._readFont(a,0)]},_readFont:function(t,e){var a=r._bin,o=e;a.readFixed(t,e),e+=4;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:o},f={},c=0;c<n;c++){var d=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var p=a.readUint(t,e);e+=4;var g=a.readUint(t,e);e+=4,f[d]={offset:p,length:g}}for(c=0;c<i.length;c++){var m=i[c];f[m]&&(s[m.trim()]=r[m.trim()].parse(t,f[m].offset,f[m].length,s))}return s},_tabOffset:function(t,e,a){for(var o=r._bin,n=o.readUshort(t,a+4),i=a+12,s=0;s<n;s++){var f=o.readASCII(t,i,4);i+=4,o.readUint(t,i),i+=4;var c=o.readUint(t,i);if(i+=4,o.readUint(t,i),i+=4,f==e)return c}return 0}};r._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return r._bin.readShort(t,e)/16384},readInt:function(t,e){return r._bin._view(t).getInt32(e)},readInt8:function(t,e){return r._bin._view(t).getInt8(e)},readShort:function(t,e){return r._bin._view(t).getInt16(e)},readUshort:function(t,e){return r._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(r._bin.readUshort(t,e+2*n));return o},readUint:function(t,e){return r._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*r._bin.readUint(t,e)+r._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var o="",n=0;n<a;n++)o+=String.fromCharCode(t[e+n]);return o},readUnicode:function(t,e,a){for(var o="",n=0;n<a;n++){var i=t[e++]<<8|t[e++];o+=String.fromCharCode(i)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var o=r._bin._tdec;return o&&e==0&&a==t.length?o.decode(t):r._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(t[e+n]);return o},readASCIIArray:function(t,e,a){for(var o=[],n=0;n<a;n++)o.push(String.fromCharCode(t[e+n]));return o},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},r._lctf={},r._lctf.parse=function(t,e,a,o,n){var i=r._bin,s={},f=e;i.readFixed(t,e),e+=4;var c=i.readUshort(t,e);e+=2;var d=i.readUshort(t,e);e+=2;var p=i.readUshort(t,e);return e+=2,s.scriptList=r._lctf.readScriptList(t,f+c),s.featureList=r._lctf.readFeatureList(t,f+d),s.lookupList=r._lctf.readLookupList(t,f+p,n),s},r._lctf.readLookupList=function(t,e,a){var o=r._bin,n=e,i=[],s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var c=o.readUshort(t,e);e+=2;var d=r._lctf.readLookupTable(t,n+c,a);i.push(d)}return i},r._lctf.readLookupTable=function(t,e,a){var o=r._bin,n=e,i={tabs:[]};i.ltype=o.readUshort(t,e),e+=2,i.flag=o.readUshort(t,e),e+=2;var s=o.readUshort(t,e);e+=2;for(var f=i.ltype,c=0;c<s;c++){var d=o.readUshort(t,e);e+=2;var p=a(t,f,n+d,i);i.tabs.push(p)}return i},r._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},r._lctf.readClassDef=function(t,e){var a=r._bin,o=[],n=a.readUshort(t,e);if(e+=2,n==1){var i=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++)o.push(i+f),o.push(i+f),o.push(a.readUshort(t,e)),e+=2}if(n==2){var c=a.readUshort(t,e);for(e+=2,f=0;f<c;f++)o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2,o.push(a.readUshort(t,e)),e+=2}return o},r._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var o=t[a],n=t[a+1];if(t[a+2],o<=e&&e<=n)return a}return-1},r._lctf.readCoverage=function(t,e){var a=r._bin,o={};o.fmt=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.fmt==1&&(o.tab=a.readUshorts(t,e,n)),o.fmt==2&&(o.tab=a.readUshorts(t,e,3*n)),o},r._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var o=r._lctf.getInterval(a,e);if(o!=-1)return a[o+2]+(e-a[o])}return-1},r._lctf.readFeatureList=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readASCII(t,e,4);e+=4;var c=a.readUshort(t,e);e+=2;var d=r._lctf.readFeatureTable(t,o+c);d.tag=f.trim(),n.push(d)}return n},r._lctf.readFeatureTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.featureParams=o+i);var s=a.readUshort(t,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(a.readUshort(t,e+2*f));return n},r._lctf.readScriptList=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readASCII(t,e,4);e+=4;var c=a.readUshort(t,e);e+=2,n[f.trim()]=r._lctf.readScriptTable(t,o+c)}return n},r._lctf.readScriptTable=function(t,e){var a=r._bin,o=e,n={},i=a.readUshort(t,e);e+=2,i>0&&(n.default=r._lctf.readLangSysTable(t,o+i));var s=a.readUshort(t,e);e+=2;for(var f=0;f<s;f++){var c=a.readASCII(t,e,4);e+=4;var d=a.readUshort(t,e);e+=2,n[c.trim()]=r._lctf.readLangSysTable(t,o+d)}return n},r._lctf.readLangSysTable=function(t,e){var a=r._bin,o={};a.readUshort(t,e),e+=2,o.reqFeature=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);return e+=2,o.features=a.readUshorts(t,e,n),o},r.CFF={},r.CFF.parse=function(t,e,a){var o=r._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var n=[];e=r.CFF.readIndex(t,e,n);for(var i=[],s=0;s<n.length-1;s++)i.push(o.readASCII(t,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=r.CFF.readIndex(t,e,f);var c=[];for(s=0;s<f.length-1;s++)c.push(r.CFF.readDict(t,e+f[s],e+f[s+1]));e+=f[f.length-1];var d=c[0],p=[];e=r.CFF.readIndex(t,e,p);var g=[];for(s=0;s<p.length-1;s++)g.push(o.readASCII(t,e+p[s],p[s+1]-p[s]));if(e+=p[p.length-1],r.CFF.readSubrs(t,e,d),d.CharStrings){e=d.CharStrings,p=[],e=r.CFF.readIndex(t,e,p);var m=[];for(s=0;s<p.length-1;s++)m.push(o.readBytes(t,e+p[s],p[s+1]-p[s]));d.CharStrings=m}if(d.ROS){e=d.FDArray;var B=[];for(e=r.CFF.readIndex(t,e,B),d.FDArray=[],s=0;s<B.length-1;s++){var S=r.CFF.readDict(t,e+B[s],e+B[s+1]);r.CFF._readFDict(t,S,g),d.FDArray.push(S)}e+=B[B.length-1],e=d.FDSelect,d.FDSelect=[];var T=t[e];if(e++,T!=3)throw T;var b=o.readUshort(t,e);for(e+=2,s=0;s<b+1;s++)d.FDSelect.push(o.readUshort(t,e),t[e+2]),e+=3}return d.Encoding&&(d.Encoding=r.CFF.readEncoding(t,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=r.CFF.readCharset(t,d.charset,d.CharStrings.length)),r.CFF._readFDict(t,d,g),d},r.CFF._readFDict=function(t,e,a){var o;for(var n in e.Private&&(o=e.Private[1],e.Private=r.CFF.readDict(t,o,o+e.Private[0]),e.Private.Subrs&&r.CFF.readSubrs(t,o+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=a[e[n]-426+35])},r.CFF.readSubrs=function(t,e,a){var o=r._bin,n=[];e=r.CFF.readIndex(t,e,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var f=0;f<n.length-1;f++)a.Subrs.push(o.readBytes(t,e+n[f],n[f+1]-n[f]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},r.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:r.CFF.glyphByUnicode(t,r.CFF.tableSE[e])},r.CFF.readEncoding=function(t,e,a){r._bin;var o=[".notdef"],n=t[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var i=t[e];e++;for(var s=0;s<i;s++)o.push(t[e+s]);return o},r.CFF.readCharset=function(t,e,a){var o=r._bin,n=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<a;s++){var f=o.readUshort(t,e);e+=2,n.push(f)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<a;){f=o.readUshort(t,e),e+=2;var c=0;for(i==1?(c=t[e],e++):(c=o.readUshort(t,e),e+=2),s=0;s<=c;s++)n.push(f),f++}}return n},r.CFF.readIndex=function(t,e,a){var o=r._bin,n=o.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<n;s++)a.push(t[e+s]);else if(i==2)for(s=0;s<n;s++)a.push(o.readUshort(t,e+2*s));else if(i==3)for(s=0;s<n;s++)a.push(16777215&o.readUint(t,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(e+=n*i)-1},r.CFF.getCharString=function(t,e,a){var o=r._bin,n=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,f=null,c=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+i,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(c=o.readShort(t,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(c=n-139,s=1),247<=n&&n<=250&&(c=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(c=256*-(n-251)-i-108,s=2),n==255&&(c=o.readInt(t,e+1)/65535,s=5),a.val=c??"o"+f,a.size=s},r.CFF.readCharString=function(t,e,a){for(var o=e+a,n=r._bin,i=[];e<o;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var c=1,d=null,p=null;s<=20&&(d=s,c=1),s==12&&(d=100*s+f,c=2),s!=19&&s!=20||(d=s,c=2),21<=s&&s<=27&&(d=s,c=1),s==28&&(p=n.readShort(t,e+1),c=3),29<=s&&s<=31&&(d=s,c=1),32<=s&&s<=246&&(p=s-139,c=1),247<=s&&s<=250&&(p=256*(s-247)+f+108,c=2),251<=s&&s<=254&&(p=256*-(s-251)-f-108,c=2),s==255&&(p=n.readInt(t,e+1)/65535,c=5),i.push(p??"o"+d),e+=c}return i},r.CFF.readDict=function(t,e,a){for(var o=r._bin,n={},i=[];e<a;){var s=t[e],f=t[e+1];t[e+2],t[e+3],t[e+4];var c=1,d=null,p=null;if(s==28&&(p=o.readShort(t,e+1),c=3),s==29&&(p=o.readInt(t,e+1),c=5),32<=s&&s<=246&&(p=s-139,c=1),247<=s&&s<=250&&(p=256*(s-247)+f+108,c=2),251<=s&&s<=254&&(p=256*-(s-251)-f-108,c=2),s==255)throw p=o.readInt(t,e+1)/65535,c=5,"unknown number";if(s==30){var g=[];for(c=1;;){var m=t[e+c];c++;var B=m>>4,S=15&m;if(B!=15&&g.push(B),S!=15&&g.push(S),S==15)break}for(var T="",b=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],F=0;F<g.length;F++)T+=b[g[F]];p=parseFloat(T)}s<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,s==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],c=2)),d!=null?(n[d]=i.length==1?i[0]:i,i=[]):i.push(p),e+=c}return n},r.cmap={},r.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2;var s=[];n.tables=[];for(var f=0;f<i;f++){var c=o.readUshort(t,e);e+=2;var d=o.readUshort(t,e);e+=2;var p=o.readUint(t,e);e+=4;var g="p"+c+"e"+d,m=s.indexOf(p);if(m==-1){var B;m=n.tables.length,s.push(p);var S=o.readUshort(t,p);S==0?B=r.cmap.parse0(t,p):S==4?B=r.cmap.parse4(t,p):S==6?B=r.cmap.parse6(t,p):S==12?B=r.cmap.parse12(t,p):console.debug("unknown format: "+S,c,d,p),n.tables.push(B)}if(n[g]!=null)throw"multiple tables for one platform+encoding";n[g]=m}return n},r.cmap.parse0=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,o.map=[];for(var i=0;i<n-6;i++)o.map.push(t[e+i]);return o},r.cmap.parse4=function(t,e){var a=r._bin,o=e,n={};n.format=a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var f=s/2;n.searchRange=a.readUshort(t,e),e+=2,n.entrySelector=a.readUshort(t,e),e+=2,n.rangeShift=a.readUshort(t,e),e+=2,n.endCount=a.readUshorts(t,e,f),e+=2*f,e+=2,n.startCount=a.readUshorts(t,e,f),e+=2*f,n.idDelta=[];for(var c=0;c<f;c++)n.idDelta.push(a.readShort(t,e)),e+=2;for(n.idRangeOffset=a.readUshorts(t,e,f),e+=2*f,n.glyphIdArray=[];e<o+i;)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},r.cmap.parse6=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,o.firstCode=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2,o.glyphIdArray=[];for(var i=0;i<n;i++)o.glyphIdArray.push(a.readUshort(t,e)),e+=2;return o},r.cmap.parse12=function(t,e){var a=r._bin,o={};o.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var n=a.readUint(t,e);e+=4,o.groups=[];for(var i=0;i<n;i++){var s=e+12*i,f=a.readUint(t,s+0),c=a.readUint(t,s+4),d=a.readUint(t,s+8);o.groups.push([f,c,d])}return o},r.glyf={},r.glyf.parse=function(t,e,a,o){for(var n=[],i=0;i<o.maxp.numGlyphs;i++)n.push(null);return n},r.glyf._parseGlyf=function(t,e){var a=r._bin,o=t._data,n=r._tabOffset(o,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=a.readShort(o,n),n+=2,i.xMin=a.readShort(o,n),n+=2,i.yMin=a.readShort(o,n),n+=2,i.xMax=a.readShort(o,n),n+=2,i.yMax=a.readShort(o,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(o,n)),n+=2;var f=a.readUshort(o,n);if(n+=2,o.length-n<f)return null;i.instructions=a.readBytes(o,n,f),n+=f;var c=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<c;s++){var d=o[n];if(n++,i.flags.push(d),(8&d)!=0){var p=o[n];n++;for(var g=0;g<p;g++)i.flags.push(d),s++}}for(i.xs=[],s=0;s<c;s++){var m=(2&i.flags[s])!=0,B=(16&i.flags[s])!=0;m?(i.xs.push(B?o[n]:-o[n]),n++):B?i.xs.push(0):(i.xs.push(a.readShort(o,n)),n+=2)}for(i.ys=[],s=0;s<c;s++)m=(4&i.flags[s])!=0,B=(32&i.flags[s])!=0,m?(i.ys.push(B?o[n]:-o[n]),n++):B?i.ys.push(0):(i.ys.push(a.readShort(o,n)),n+=2);var S=0,T=0;for(s=0;s<c;s++)S+=i.xs[s],T+=i.ys[s],i.xs[s]=S,i.ys[s]=T}else{var b;i.parts=[];do{b=a.readUshort(o,n),n+=2;var F={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(F),F.glyphIndex=a.readUshort(o,n),n+=2,1&b){var O=a.readShort(o,n);n+=2;var w=a.readShort(o,n);n+=2}else O=a.readInt8(o,n),n++,w=a.readInt8(o,n),n++;2&b?(F.m.tx=O,F.m.ty=w):(F.p1=O,F.p2=w),8&b?(F.m.a=F.m.d=a.readF2dot14(o,n),n+=2):64&b?(F.m.a=a.readF2dot14(o,n),n+=2,F.m.d=a.readF2dot14(o,n),n+=2):128&b&&(F.m.a=a.readF2dot14(o,n),n+=2,F.m.b=a.readF2dot14(o,n),n+=2,F.m.c=a.readF2dot14(o,n),n+=2,F.m.d=a.readF2dot14(o,n),n+=2)}while(32&b);if(256&b){var A=a.readUshort(o,n);for(n+=2,i.instr=[],s=0;s<A;s++)i.instr.push(o[n]),n++}}return i},r.GDEF={},r.GDEF.parse=function(t,e,a,o){var n=e;e+=4;var i=r._bin.readUshort(t,e);return{glyphClassDef:i===0?null:r._lctf.readClassDef(t,n+i)}},r.GPOS={},r.GPOS.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GPOS.subt)},r.GPOS.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,f+i)}if(e==1&&s.fmt==1){var c=n.readUshort(t,a);a+=2,c!=0&&(s.pos=r.GPOS.readValueRecord(t,a,c))}else if(e==2&&s.fmt>=1&&s.fmt<=2){c=n.readUshort(t,a),a+=2;var d=n.readUshort(t,a);a+=2;var p=r._lctf.numOfOnes(c),g=r._lctf.numOfOnes(d);if(s.fmt==1){s.pairsets=[];var m=n.readUshort(t,a);a+=2;for(var B=0;B<m;B++){var S=i+n.readUshort(t,a);a+=2;var T=n.readUshort(t,S);S+=2;for(var b=[],F=0;F<T;F++){var O=n.readUshort(t,S);S+=2,c!=0&&(y=r.GPOS.readValueRecord(t,S,c),S+=2*p),d!=0&&(E=r.GPOS.readValueRecord(t,S,d),S+=2*g),b.push({gid2:O,val1:y,val2:E})}s.pairsets.push(b)}}if(s.fmt==2){var w=n.readUshort(t,a);a+=2;var A=n.readUshort(t,a);a+=2;var j=n.readUshort(t,a);a+=2;var R=n.readUshort(t,a);for(a+=2,s.classDef1=r._lctf.readClassDef(t,i+w),s.classDef2=r._lctf.readClassDef(t,i+A),s.matrix=[],B=0;B<j;B++){var J=[];for(F=0;F<R;F++){var y=null,E=null;c!=0&&(y=r.GPOS.readValueRecord(t,a,c),a+=2*p),d!=0&&(E=r.GPOS.readValueRecord(t,a,d),a+=2*g),J.push({val1:y,val2:E})}s.matrix.push(J)}}}else if(e==4&&s.fmt==1)s.markCoverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.baseCoverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.markArray=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.baseArray=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=r._lctf.readCoverage(t,n.readUshort(t,a)+i),s.mark2Coverage=r._lctf.readCoverage(t,n.readUshort(t,a+2)+i),s.markClassCount=n.readUshort(t,a+4),s.mark1Array=r.GPOS.readMarkArray(t,n.readUshort(t,a+6)+i),s.mark2Array=r.GPOS.readBaseArray(t,n.readUshort(t,a+8)+i,s.markClassCount);else{if(e==9&&s.fmt==1){var C=n.readUshort(t,a);a+=2;var X=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=C;else if(o.ltype!=C)throw"invalid extension substitution";return r.GPOS.subt(t,o.ltype,i+X)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},r.GPOS.readValueRecord=function(t,e,a){var o=r._bin,n=[];return n.push(1&a?o.readShort(t,e):0),e+=1&a?2:0,n.push(2&a?o.readShort(t,e):0),e+=2&a?2:0,n.push(4&a?o.readShort(t,e):0),e+=4&a?2:0,n.push(8&a?o.readShort(t,e):0),e+=8&a?2:0,n},r.GPOS.readBaseArray=function(t,e,a){var o=r._bin,n=[],i=e,s=o.readUshort(t,e);e+=2;for(var f=0;f<s;f++){for(var c=[],d=0;d<a;d++)c.push(r.GPOS.readAnchorRecord(t,i+o.readUshort(t,e))),e+=2;n.push(c)}return n},r.GPOS.readMarkArray=function(t,e){var a=r._bin,o=[],n=e,i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=r.GPOS.readAnchorRecord(t,a.readUshort(t,e+2)+n);f.markClass=a.readUshort(t,e),o.push(f),e+=4}return o},r.GPOS.readAnchorRecord=function(t,e){var a=r._bin,o={};return o.fmt=a.readUshort(t,e),o.x=a.readShort(t,e+2),o.y=a.readShort(t,e+4),o},r.GSUB={},r.GSUB.parse=function(t,e,a,o){return r._lctf.parse(t,e,a,o,r.GSUB.subt)},r.GSUB.subt=function(t,e,a,o){var n=r._bin,i=a,s={};if(s.fmt=n.readUshort(t,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(t,a);a+=2,s.coverage=r._lctf.readCoverage(t,i+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(t,a),a+=2;else if(s.fmt==2){var c=n.readUshort(t,a);a+=2,s.newg=n.readUshorts(t,a,c),a+=2*s.newg.length}}else if(e==2&&s.fmt==1){c=n.readUshort(t,a),a+=2,s.seqs=[];for(var d=0;d<c;d++){var p=n.readUshort(t,a)+i;a+=2;var g=n.readUshort(t,p);s.seqs.push(n.readUshorts(t,p+2,g))}}else if(e==4)for(s.vals=[],c=n.readUshort(t,a),a+=2,d=0;d<c;d++){var m=n.readUshort(t,a);a+=2,s.vals.push(r.GSUB.readLigatureSet(t,i+m))}else if(e==5&&s.fmt==2){if(s.fmt==2){var B=n.readUshort(t,a);a+=2,s.cDef=r._lctf.readClassDef(t,i+B),s.scset=[];var S=n.readUshort(t,a);for(a+=2,d=0;d<S;d++){var T=n.readUshort(t,a);a+=2,s.scset.push(T==0?null:r.GSUB.readSubClassSet(t,i+T))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(d=0;d<3;d++){c=n.readUshort(t,a),a+=2;for(var b=[],F=0;F<c;F++)b.push(r._lctf.readCoverage(t,i+n.readUshort(t,a+2*F)));a+=2*c,d==0&&(s.backCvg=b),d==1&&(s.inptCvg=b),d==2&&(s.ahedCvg=b)}c=n.readUshort(t,a),a+=2,s.lookupRec=r.GSUB.readSubstLookupRecords(t,a,c)}}else{if(e==7&&s.fmt==1){var O=n.readUshort(t,a);a+=2;var w=n.readUint(t,a);if(a+=4,o.ltype==9)o.ltype=O;else if(o.ltype!=O)throw"invalid extension substitution";return r.GSUB.subt(t,o.ltype,i+w)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},r.GSUB.readSubClassSet=function(t,e){var a=r._bin.readUshort,o=e,n=[],i=a(t,e);e+=2;for(var s=0;s<i;s++){var f=a(t,e);e+=2,n.push(r.GSUB.readSubClassRule(t,o+f))}return n},r.GSUB.readSubClassRule=function(t,e){var a=r._bin.readUshort,o={},n=a(t,e),i=a(t,e+=2);e+=2,o.input=[];for(var s=0;s<n-1;s++)o.input.push(a(t,e)),e+=2;return o.substLookupRecords=r.GSUB.readSubstLookupRecords(t,e,i),o},r.GSUB.readSubstLookupRecords=function(t,e,a){for(var o=r._bin.readUshort,n=[],i=0;i<a;i++)n.push(o(t,e),o(t,e+2)),e+=4;return n},r.GSUB.readChainSubClassSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readChainSubClassRule(t,o+f))}return n},r.GSUB.readChainSubClassRule=function(t,e){for(var a=r._bin,o={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=a.readUshort(t,e);e+=2,i==1&&s--,o[n[i]]=a.readUshorts(t,e,s),e+=2*o[n[i]].length}return s=a.readUshort(t,e),e+=2,o.subst=a.readUshorts(t,e,2*s),e+=2*o.subst.length,o},r.GSUB.readLigatureSet=function(t,e){var a=r._bin,o=e,n=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var f=a.readUshort(t,e);e+=2,n.push(r.GSUB.readLigature(t,o+f))}return n},r.GSUB.readLigature=function(t,e){var a=r._bin,o={chain:[]};o.nglyph=a.readUshort(t,e),e+=2;var n=a.readUshort(t,e);e+=2;for(var i=0;i<n-1;i++)o.chain.push(a.readUshort(t,e)),e+=2;return o},r.head={},r.head.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.fontRevision=o.readFixed(t,e),e+=4,o.readUint(t,e),e+=4,o.readUint(t,e),e+=4,n.flags=o.readUshort(t,e),e+=2,n.unitsPerEm=o.readUshort(t,e),e+=2,n.created=o.readUint64(t,e),e+=8,n.modified=o.readUint64(t,e),e+=8,n.xMin=o.readShort(t,e),e+=2,n.yMin=o.readShort(t,e),e+=2,n.xMax=o.readShort(t,e),e+=2,n.yMax=o.readShort(t,e),e+=2,n.macStyle=o.readUshort(t,e),e+=2,n.lowestRecPPEM=o.readUshort(t,e),e+=2,n.fontDirectionHint=o.readShort(t,e),e+=2,n.indexToLocFormat=o.readShort(t,e),e+=2,n.glyphDataFormat=o.readShort(t,e),e+=2,n},r.hhea={},r.hhea.parse=function(t,e,a){var o=r._bin,n={};return o.readFixed(t,e),e+=4,n.ascender=o.readShort(t,e),e+=2,n.descender=o.readShort(t,e),e+=2,n.lineGap=o.readShort(t,e),e+=2,n.advanceWidthMax=o.readUshort(t,e),e+=2,n.minLeftSideBearing=o.readShort(t,e),e+=2,n.minRightSideBearing=o.readShort(t,e),e+=2,n.xMaxExtent=o.readShort(t,e),e+=2,n.caretSlopeRise=o.readShort(t,e),e+=2,n.caretSlopeRun=o.readShort(t,e),e+=2,n.caretOffset=o.readShort(t,e),e+=2,e+=8,n.metricDataFormat=o.readShort(t,e),e+=2,n.numberOfHMetrics=o.readUshort(t,e),e+=2,n},r.hmtx={},r.hmtx.parse=function(t,e,a,o){for(var n=r._bin,i={aWidth:[],lsBearing:[]},s=0,f=0,c=0;c<o.maxp.numGlyphs;c++)c<o.hhea.numberOfHMetrics&&(s=n.readUshort(t,e),e+=2,f=n.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(f);return i},r.kern={},r.kern.parse=function(t,e,a,o){var n=r._bin,i=n.readUshort(t,e);if(e+=2,i==1)return r.kern.parseV1(t,e-2,a,o);var s=n.readUshort(t,e);e+=2;for(var f={glyph1:[],rval:[]},c=0;c<s;c++){e+=2,a=n.readUshort(t,e),e+=2;var d=n.readUshort(t,e);e+=2;var p=d>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=r.kern.readFormat0(t,e,f)}return f},r.kern.parseV1=function(t,e,a,o){var n=r._bin;n.readFixed(t,e),e+=4;var i=n.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<i;f++){n.readUint(t,e),e+=4;var c=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2;var d=c>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;e=r.kern.readFormat0(t,e,s)}return s},r.kern.readFormat0=function(t,e,a){var o=r._bin,n=-1,i=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var f=o.readUshort(t,e);e+=2;var c=o.readUshort(t,e);e+=2;var d=o.readShort(t,e);e+=2,f!=n&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var p=a.rval[a.rval.length-1];p.glyph2.push(c),p.vals.push(d),n=f}return e},r.loca={},r.loca.parse=function(t,e,a,o){var n=r._bin,i=[],s=o.head.indexToLocFormat,f=o.maxp.numGlyphs+1;if(s==0)for(var c=0;c<f;c++)i.push(n.readUshort(t,e+(c<<1))<<1);if(s==1)for(c=0;c<f;c++)i.push(n.readUint(t,e+(c<<2)));return i},r.maxp={},r.maxp.parse=function(t,e,a){var o=r._bin,n={},i=o.readUint(t,e);return e+=4,n.numGlyphs=o.readUshort(t,e),e+=2,i==65536&&(n.maxPoints=o.readUshort(t,e),e+=2,n.maxContours=o.readUshort(t,e),e+=2,n.maxCompositePoints=o.readUshort(t,e),e+=2,n.maxCompositeContours=o.readUshort(t,e),e+=2,n.maxZones=o.readUshort(t,e),e+=2,n.maxTwilightPoints=o.readUshort(t,e),e+=2,n.maxStorage=o.readUshort(t,e),e+=2,n.maxFunctionDefs=o.readUshort(t,e),e+=2,n.maxInstructionDefs=o.readUshort(t,e),e+=2,n.maxStackElements=o.readUshort(t,e),e+=2,n.maxSizeOfInstructions=o.readUshort(t,e),e+=2,n.maxComponentElements=o.readUshort(t,e),e+=2,n.maxComponentDepth=o.readUshort(t,e),e+=2),n},r.name={},r.name.parse=function(t,e,a){var o=r._bin,n={};o.readUshort(t,e),e+=2;var i=o.readUshort(t,e);e+=2,o.readUshort(t,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=e+=2,d=0;d<i;d++){var p=o.readUshort(t,e);e+=2;var g=o.readUshort(t,e);e+=2;var m=o.readUshort(t,e);e+=2;var B=o.readUshort(t,e);e+=2;var S=o.readUshort(t,e);e+=2;var T=o.readUshort(t,e);e+=2;var b,F=f[B],O=c+12*i+T;if(p==0)b=o.readUnicode(t,O,S/2);else if(p==3&&g==0)b=o.readUnicode(t,O,S/2);else if(g==0)b=o.readASCII(t,O,S);else if(g==1)b=o.readUnicode(t,O,S/2);else if(g==3)b=o.readUnicode(t,O,S/2);else{if(p!=1)throw"unknown encoding "+g+", platformID: "+p;b=o.readASCII(t,O,S),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var w="p"+p+","+m.toString(16);n[w]==null&&(n[w]={}),n[w][F!==void 0?F:B]=b,n[w]._lang=m}for(var A in n)if(n[A].postScriptName!=null&&n[A]._lang==1033)return n[A];for(var A in n)if(n[A].postScriptName!=null&&n[A]._lang==0)return n[A];for(var A in n)if(n[A].postScriptName!=null&&n[A]._lang==3084)return n[A];for(var A in n)if(n[A].postScriptName!=null)return n[A];for(var A in n){s=A;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},r["OS/2"]={},r["OS/2"].parse=function(t,e,a){var o=r._bin.readUshort(t,e);e+=2;var n={};if(o==0)r["OS/2"].version0(t,e,n);else if(o==1)r["OS/2"].version1(t,e,n);else if(o==2||o==3||o==4)r["OS/2"].version2(t,e,n);else{if(o!=5)throw"unknown OS/2 table version: "+o;r["OS/2"].version5(t,e,n)}return n},r["OS/2"].version0=function(t,e,a){var o=r._bin;return a.xAvgCharWidth=o.readShort(t,e),e+=2,a.usWeightClass=o.readUshort(t,e),e+=2,a.usWidthClass=o.readUshort(t,e),e+=2,a.fsType=o.readUshort(t,e),e+=2,a.ySubscriptXSize=o.readShort(t,e),e+=2,a.ySubscriptYSize=o.readShort(t,e),e+=2,a.ySubscriptXOffset=o.readShort(t,e),e+=2,a.ySubscriptYOffset=o.readShort(t,e),e+=2,a.ySuperscriptXSize=o.readShort(t,e),e+=2,a.ySuperscriptYSize=o.readShort(t,e),e+=2,a.ySuperscriptXOffset=o.readShort(t,e),e+=2,a.ySuperscriptYOffset=o.readShort(t,e),e+=2,a.yStrikeoutSize=o.readShort(t,e),e+=2,a.yStrikeoutPosition=o.readShort(t,e),e+=2,a.sFamilyClass=o.readShort(t,e),e+=2,a.panose=o.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=o.readUint(t,e),e+=4,a.ulUnicodeRange2=o.readUint(t,e),e+=4,a.ulUnicodeRange3=o.readUint(t,e),e+=4,a.ulUnicodeRange4=o.readUint(t,e),e+=4,a.achVendID=[o.readInt8(t,e),o.readInt8(t,e+1),o.readInt8(t,e+2),o.readInt8(t,e+3)],e+=4,a.fsSelection=o.readUshort(t,e),e+=2,a.usFirstCharIndex=o.readUshort(t,e),e+=2,a.usLastCharIndex=o.readUshort(t,e),e+=2,a.sTypoAscender=o.readShort(t,e),e+=2,a.sTypoDescender=o.readShort(t,e),e+=2,a.sTypoLineGap=o.readShort(t,e),e+=2,a.usWinAscent=o.readUshort(t,e),e+=2,a.usWinDescent=o.readUshort(t,e),e+=2},r["OS/2"].version1=function(t,e,a){var o=r._bin;return e=r["OS/2"].version0(t,e,a),a.ulCodePageRange1=o.readUint(t,e),e+=4,a.ulCodePageRange2=o.readUint(t,e),e+=4},r["OS/2"].version2=function(t,e,a){var o=r._bin;return e=r["OS/2"].version1(t,e,a),a.sxHeight=o.readShort(t,e),e+=2,a.sCapHeight=o.readShort(t,e),e+=2,a.usDefault=o.readUshort(t,e),e+=2,a.usBreak=o.readUshort(t,e),e+=2,a.usMaxContext=o.readUshort(t,e),e+=2},r["OS/2"].version5=function(t,e,a){var o=r._bin;return e=r["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=o.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=o.readUshort(t,e),e+=2},r.post={},r.post.parse=function(t,e,a){var o=r._bin,n={};return n.version=o.readFixed(t,e),e+=4,n.italicAngle=o.readFixed(t,e),e+=4,n.underlinePosition=o.readShort(t,e),e+=2,n.underlineThickness=o.readShort(t,e),e+=2,n},r==null&&(r={}),r.U==null&&(r.U={}),r.U.codeToGlyph=function(t,e){var a=t.cmap,o=-1;if(a.p0e4!=null?o=a.p0e4:a.p3e1!=null?o=a.p3e1:a.p1e0!=null?o=a.p1e0:a.p0e3!=null&&(o=a.p0e3),o==-1)throw"no familiar platform and encoding!";var n=a.tables[o];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>e?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[e-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:e+n.idDelta[i])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},r.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var o=t.SVG.entries[e];return o==null?a:(typeof o=="string"&&(o=r.SVG.toPath(o),t.SVG.entries[e]=o),o)}if(t.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var f=0;i.FDSelect[f+2]<=e;)f+=2;s=i.FDArray[i.FDSelect[f+1]].Private}r.U._drawCFF(t.CFF.CharStrings[e],n,i,s,a)}else t.glyf&&r.U._drawGlyf(e,t,a);return a},r.U._drawGlyf=function(t,e,a){var o=e.glyf[t];o==null&&(o=e.glyf[t]=r.glyf._parseGlyf(e,t)),o!=null&&(o.noc>-1?r.U._simpleGlyph(o,a):r.U._compoGlyph(o,e,a))},r.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var o=a==0?0:t.endPts[a-1]+1,n=t.endPts[a],i=o;i<=n;i++){var s=i==o?n:i-1,f=i==n?o:i+1,c=1&t.flags[i],d=1&t.flags[s],p=1&t.flags[f],g=t.xs[i],m=t.ys[i];if(i==o)if(c){if(!d){r.U.P.moveTo(e,g,m);continue}r.U.P.moveTo(e,t.xs[s],t.ys[s])}else d?r.U.P.moveTo(e,t.xs[s],t.ys[s]):r.U.P.moveTo(e,(t.xs[s]+g)/2,(t.ys[s]+m)/2);c?d&&r.U.P.lineTo(e,g,m):p?r.U.P.qcurveTo(e,g,m,t.xs[f],t.ys[f]):r.U.P.qcurveTo(e,g,m,(g+t.xs[f])/2,(m+t.ys[f])/2)}r.U.P.closePath(e)}},r.U._compoGlyph=function(t,e,a){for(var o=0;o<t.parts.length;o++){var n={cmds:[],crds:[]},i=t.parts[o];r.U._drawGlyf(i.glyphIndex,e,n);for(var s=i.m,f=0;f<n.crds.length;f+=2){var c=n.crds[f],d=n.crds[f+1];a.crds.push(c*s.a+d*s.b+s.tx),a.crds.push(c*s.c+d*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)a.cmds.push(n.cmds[f])}},r.U._getGlyphClass=function(t,e){var a=r._lctf.getInterval(e,t);return a==-1?0:e[a+2]},r.U._applySubs=function(t,e,a,o){for(var n=t.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,f=a.tabs[i];if(!f.coverage||(s=r._lctf.coverageIndex(f.coverage,t[e]))!=-1){if(a.ltype==1)t[e],f.fmt==1?t[e]=t[e]+f.delta:t[e]=f.newg[s];else if(a.ltype==4)for(var c=f.vals[s],d=0;d<c.length;d++){var p=c[d],g=p.chain.length;if(!(g>n)){for(var m=!0,B=0,S=0;S<g;S++){for(;t[e+B+(1+S)]==-1;)B++;p.chain[S]!=t[e+B+(1+S)]&&(m=!1)}if(m){for(t[e]=p.nglyph,S=0;S<g+B;S++)t[e+S+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var T=r._lctf.getInterval(f.cDef,t[e]),b=f.cDef[T+2],F=f.scset[b],O=0;O<F.length;O++){var w=F[O],A=w.input;if(!(A.length>n)){for(m=!0,S=0;S<A.length;S++){var j=r._lctf.getInterval(f.cDef,t[e+1+S]);if(T==-1&&f.cDef[j+2]!=A[S]){m=!1;break}}if(m){var R=w.substLookupRecords;for(d=0;d<R.length;d+=2)R[d],R[d+1]}}}else if(a.ltype==6&&f.fmt==3){if(!r.U._glsCovered(t,f.backCvg,e-f.backCvg.length)||!r.U._glsCovered(t,f.inptCvg,e)||!r.U._glsCovered(t,f.ahedCvg,e+f.inptCvg.length))continue;var J=f.lookupRec;for(O=0;O<J.length;O+=2){T=J[O];var y=o[J[O+1]];r.U._applySubs(t,e+T,y,o)}}}}},r.U._glsCovered=function(t,e,a){for(var o=0;o<e.length;o++)if(r._lctf.coverageIndex(e[o],t[a+o])==-1)return!1;return!0},r.U.glyphsToPath=function(t,e,a){for(var o={cmds:[],crds:[]},n=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var f=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,c=r.U.glyphToPath(t,s),d=0;d<c.crds.length;d+=2)o.crds.push(c.crds[d]+n),o.crds.push(c.crds[d+1]);for(a&&o.cmds.push(a),d=0;d<c.cmds.length;d++)o.cmds.push(c.cmds[d]);a&&o.cmds.push("X"),n+=t.hmtx.aWidth[s],i<e.length-1&&(n+=r.U.getPairAdjustment(t,s,f))}}return o},r.U.P={},r.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},r.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},r.U.P.curveTo=function(t,e,a,o,n,i,s){t.cmds.push("C"),t.crds.push(e,a,o,n,i,s)},r.U.P.qcurveTo=function(t,e,a,o,n){t.cmds.push("Q"),t.crds.push(e,a,o,n)},r.U.P.closePath=function(t){t.cmds.push("Z")},r.U._drawCFF=function(t,e,a,o,n){for(var i=e.stack,s=e.nStems,f=e.haveWidth,c=e.width,d=e.open,p=0,g=e.x,m=e.y,B=0,S=0,T=0,b=0,F=0,O=0,w=0,A=0,j=0,R=0,J={val:0,size:0};p<t.length;){r.CFF.getCharString(t,p,J);var y=J.val;if(p+=J.size,y=="o1"||y=="o18")i.length%2!=0&&!f&&(c=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(y=="o3"||y=="o23")i.length%2!=0&&!f&&(c=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(y=="o4")i.length>1&&!f&&(c=i.shift()+o.nominalWidthX,f=!0),d&&r.U.P.closePath(n),m+=i.pop(),r.U.P.moveTo(n,g,m),d=!0;else if(y=="o5")for(;i.length>0;)g+=i.shift(),m+=i.shift(),r.U.P.lineTo(n,g,m);else if(y=="o6"||y=="o7")for(var E=i.length,C=y=="o6",X=0;X<E;X++){var z=i.shift();C?g+=z:m+=z,C=!C,r.U.P.lineTo(n,g,m)}else if(y=="o8"||y=="o24"){E=i.length;for(var q=0;q+6<=E;)B=g+i.shift(),S=m+i.shift(),T=B+i.shift(),b=S+i.shift(),g=T+i.shift(),m=b+i.shift(),r.U.P.curveTo(n,B,S,T,b,g,m),q+=6;y=="o24"&&(g+=i.shift(),m+=i.shift(),r.U.P.lineTo(n,g,m))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(S=m,T=(B=g+i.shift())+i.shift(),R=b=S+i.shift(),O=b,A=m,g=(w=(F=(j=T+i.shift())+i.shift())+i.shift())+i.shift(),r.U.P.curveTo(n,B,S,T,b,j,R),r.U.P.curveTo(n,F,O,w,A,g,m)),y=="o1235"&&(B=g+i.shift(),S=m+i.shift(),T=B+i.shift(),b=S+i.shift(),j=T+i.shift(),R=b+i.shift(),F=j+i.shift(),O=R+i.shift(),w=F+i.shift(),A=O+i.shift(),g=w+i.shift(),m=A+i.shift(),i.shift(),r.U.P.curveTo(n,B,S,T,b,j,R),r.U.P.curveTo(n,F,O,w,A,g,m)),y=="o1236"&&(B=g+i.shift(),S=m+i.shift(),T=B+i.shift(),R=b=S+i.shift(),O=b,w=(F=(j=T+i.shift())+i.shift())+i.shift(),A=O+i.shift(),g=w+i.shift(),r.U.P.curveTo(n,B,S,T,b,j,R),r.U.P.curveTo(n,F,O,w,A,g,m)),y=="o1237"&&(B=g+i.shift(),S=m+i.shift(),T=B+i.shift(),b=S+i.shift(),j=T+i.shift(),R=b+i.shift(),F=j+i.shift(),O=R+i.shift(),w=F+i.shift(),A=O+i.shift(),Math.abs(w-g)>Math.abs(A-m)?g=w+i.shift():m=A+i.shift(),r.U.P.curveTo(n,B,S,T,b,j,R),r.U.P.curveTo(n,F,O,w,A,g,m));else if(y=="o14"){if(i.length>0&&!f&&(c=i.shift()+a.nominalWidthX,f=!0),i.length==4){var ne=i.shift(),P=i.shift(),G=i.shift(),v=i.shift(),x=r.CFF.glyphBySE(a,G),k=r.CFF.glyphBySE(a,v);r.U._drawCFF(a.CharStrings[x],e,a,o,n),e.x=ne,e.y=P,r.U._drawCFF(a.CharStrings[k],e,a,o,n)}d&&(r.U.P.closePath(n),d=!1)}else if(y=="o19"||y=="o20")i.length%2!=0&&!f&&(c=i.shift()+o.nominalWidthX),s+=i.length>>1,i.length=0,f=!0,p+=s+7>>3;else if(y=="o21")i.length>2&&!f&&(c=i.shift()+o.nominalWidthX,f=!0),m+=i.pop(),g+=i.pop(),d&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),d=!0;else if(y=="o22")i.length>1&&!f&&(c=i.shift()+o.nominalWidthX,f=!0),g+=i.pop(),d&&r.U.P.closePath(n),r.U.P.moveTo(n,g,m),d=!0;else if(y=="o25"){for(;i.length>6;)g+=i.shift(),m+=i.shift(),r.U.P.lineTo(n,g,m);B=g+i.shift(),S=m+i.shift(),T=B+i.shift(),b=S+i.shift(),g=T+i.shift(),m=b+i.shift(),r.U.P.curveTo(n,B,S,T,b,g,m)}else if(y=="o26")for(i.length%2&&(g+=i.shift());i.length>0;)B=g,S=m+i.shift(),g=T=B+i.shift(),m=(b=S+i.shift())+i.shift(),r.U.P.curveTo(n,B,S,T,b,g,m);else if(y=="o27")for(i.length%2&&(m+=i.shift());i.length>0;)S=m,T=(B=g+i.shift())+i.shift(),b=S+i.shift(),g=T+i.shift(),m=b,r.U.P.curveTo(n,B,S,T,b,g,m);else if(y=="o10"||y=="o29"){var D=y=="o10"?o:a;if(i.length==0)console.debug("error: empty stack");else{var U=i.pop(),N=D.Subrs[U+D.Bias];e.x=g,e.y=m,e.nStems=s,e.haveWidth=f,e.width=c,e.open=d,r.U._drawCFF(N,e,a,o,n),g=e.x,m=e.y,s=e.nStems,f=e.haveWidth,c=e.width,d=e.open}}else if(y=="o30"||y=="o31"){var M=i.length,I=(q=0,y=="o31");for(q+=M-(E=-3&M);q<E;)I?(S=m,T=(B=g+i.shift())+i.shift(),m=(b=S+i.shift())+i.shift(),E-q==5?(g=T+i.shift(),q++):g=T,I=!1):(B=g,S=m+i.shift(),T=B+i.shift(),b=S+i.shift(),g=T+i.shift(),E-q==5?(m=b+i.shift(),q++):m=b,I=!0),r.U.P.curveTo(n,B,S,T,b,g,m),q+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,t),y;i.push(y)}}}e.x=g,e.y=m,e.nStems=s,e.haveWidth=f,e.width=c,e.open=d};var h=r,u={Typr:h};return l.Typr=h,l.default=u,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function fo(){return function(l){var r=Uint8Array,h=Uint16Array,u=Uint32Array,t=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(y,E){for(var C=new h(31),X=0;X<31;++X)C[X]=E+=1<<y[X-1];var z=new u(C[30]);for(X=1;X<30;++X)for(var q=C[X];q<C[X+1];++q)z[q]=q-C[X]<<5|X;return[C,z]},n=o(t,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var f=o(e,0)[0],c=new h(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,c[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var g=function(y,E,C){for(var X=y.length,z=0,q=new h(E);z<X;++z)++q[y[z]-1];var ne,P=new h(E);for(z=0;z<E;++z)P[z]=P[z-1]+q[z-1]<<1;{ne=new h(1<<E);var G=15-E;for(z=0;z<X;++z)if(y[z])for(var v=z<<4|y[z],x=E-y[z],k=P[y[z]-1]++<<x,D=k|(1<<x)-1;k<=D;++k)ne[c[k]>>>G]=v}return ne},m=new r(288);for(d=0;d<144;++d)m[d]=8;for(d=144;d<256;++d)m[d]=9;for(d=256;d<280;++d)m[d]=7;for(d=280;d<288;++d)m[d]=8;var B=new r(32);for(d=0;d<32;++d)B[d]=5;var S=g(m,9),T=g(B,5),b=function(y){for(var E=y[0],C=1;C<y.length;++C)y[C]>E&&(E=y[C]);return E},F=function(y,E,C){var X=E/8|0;return(y[X]|y[X+1]<<8)>>(7&E)&C},O=function(y,E){var C=E/8|0;return(y[C]|y[C+1]<<8|y[C+2]<<16)>>(7&E)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],A=function(y,E,C){var X=new Error(E||w[y]);if(X.code=y,Error.captureStackTrace&&Error.captureStackTrace(X,A),!C)throw X;return X},j=function(y,E,C){var X=y.length;if(!X||C&&!C.l&&X<5)return E||new r(0);var z=!E||C,q=!C||C.i;C||(C={}),E||(E=new r(3*X));var ne,P=function(fe){var De=E.length;if(fe>De){var Te=new r(Math.max(2*De,fe));Te.set(E),E=Te}},G=C.f||0,v=C.p||0,x=C.b||0,k=C.l,D=C.d,U=C.m,N=C.n,M=8*X;do{if(!k){C.f=G=F(y,v,1);var I=F(y,v+1,3);if(v+=3,!I){var Y=y[($=((ne=v)/8|0)+(7&ne&&1)+4)-4]|y[$-3]<<8,ee=$+Y;if(ee>X){q&&A(0);break}z&&P(x+Y),E.set(y.subarray($,ee),x),C.b=x+=Y,C.p=v=8*ee;continue}if(I==1)k=S,D=T,U=9,N=5;else if(I==2){var H=F(y,v,31)+257,W=F(y,v+10,15)+4,me=H+F(y,v+5,31)+1;v+=14;for(var ce=new r(me),Z=new r(19),te=0;te<W;++te)Z[a[te]]=F(y,v+3*te,7);v+=3*W;var le=b(Z),V=(1<<le)-1,re=g(Z,le);for(te=0;te<me;){var $,L=re[F(y,v,V)];if(v+=15&L,($=L>>>4)<16)ce[te++]=$;else{var de=0,Q=0;for($==16?(Q=3+F(y,v,3),v+=2,de=ce[te-1]):$==17?(Q=3+F(y,v,7),v+=3):$==18&&(Q=11+F(y,v,127),v+=7);Q--;)ce[te++]=de}}var oe=ce.subarray(0,H),K=ce.subarray(H);U=b(oe),N=b(K),k=g(oe,U),D=g(K,N)}else A(1);if(v>M){q&&A(0);break}}z&&P(x+131072);for(var Ue=(1<<U)-1,ae=(1<<N)-1,ie=v;;ie=v){var ue=(de=k[O(y,v)&Ue])>>>4;if((v+=15&de)>M){q&&A(0);break}if(de||A(2),ue<256)E[x++]=ue;else{if(ue==256){ie=v,k=null;break}var pe=ue-254;if(ue>264){var _e=t[te=ue-257];pe=F(y,v,(1<<_e)-1)+i[te],v+=_e}var Ae=D[O(y,v)&ae],ye=Ae>>>4;if(Ae||A(3),v+=15&Ae,K=f[ye],ye>3&&(_e=e[ye],K+=O(y,v)&(1<<_e)-1,v+=_e),v>M){q&&A(0);break}z&&P(x+131072);for(var xe=x+pe;x<xe;x+=4)E[x]=E[x-K],E[x+1]=E[x+1-K],E[x+2]=E[x+2-K],E[x+3]=E[x+3-K];x=xe}}C.l=k,C.p=ie,C.b=x,k&&(G=1,C.m=U,C.d=D,C.n=N)}while(!G);return x==E.length?E:function(fe,De,Te){(Te==null||Te>fe.length)&&(Te=fe.length);var Le=new(fe instanceof h?h:fe instanceof u?u:r)(Te-De);return Le.set(fe.subarray(De,Te)),Le}(E,0,x)},R=new r(0),J=typeof TextDecoder<"u"&&new TextDecoder;try{J.decode(R,{stream:!0})}catch{}return l.convert_streams=function(y){var E=new DataView(y),C=0;function X(){var H=E.getUint16(C);return C+=2,H}function z(){var H=E.getUint32(C);return C+=4,H}function q(H){Y.setUint16(ee,H),ee+=2}function ne(H){Y.setUint32(ee,H),ee+=4}for(var P={signature:z(),flavor:z(),length:z(),numTables:X(),reserved:X(),totalSfntSize:z(),majorVersion:X(),minorVersion:X(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},G=0;Math.pow(2,G)<=P.numTables;)G++;G--;for(var v=16*Math.pow(2,G),x=16*P.numTables-v,k=12,D=[],U=0;U<P.numTables;U++)D.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),k+=16;var N,M=new Uint8Array(12+16*D.length+D.reduce(function(H,W){return H+W.origLength+4},0)),I=M.buffer,Y=new DataView(I),ee=0;return ne(P.flavor),q(P.numTables),q(v),q(G),q(x),D.forEach(function(H){ne(H.tag),ne(H.origChecksum),ne(k),ne(H.origLength),H.outOffset=k,(k+=H.origLength)%4!=0&&(k+=4-k%4)}),D.forEach(function(H){var W,me=y.slice(H.offset,H.offset+H.compLength);if(H.compLength!=H.origLength){var ce=new Uint8Array(H.origLength);W=new Uint8Array(me,2),j(W,ce)}else ce=new Uint8Array(me);M.set(ce,H.outOffset);var Z=0;(k=H.outOffset+H.origLength)%4!=0&&(Z=4-k%4),M.set(new Uint8Array(Z).buffer,H.outOffset+H.origLength),N=k+Z}),I.slice(0,N)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams}function uo(l,r){const h={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,o=8,n=16,i=32;let s;function f(w){if(!s){const A={R:e,L:t,D:a,C:n,U:i,T:o};s=new Map;for(let j in u){let R=0;u[j].split(",").forEach(J=>{let[y,E]=J.split("+");y=parseInt(y,36),E=E?parseInt(E,36):0,s.set(R+=y,A[j]);for(let C=E;C--;)s.set(++R,A[j])})}}return s.get(w)||i}const c=1,d=2,p=3,g=4,m=[null,"isol","init","fina","medi"];function B(w){const A=new Uint8Array(w.length);let j=i,R=c,J=-1;for(let y=0;y<w.length;y++){const E=w.codePointAt(y);let C=f(E)|0,X=c;C&o||(j&(t|a|n)?C&(e|a|n)?(X=p,(R===c||R===p)&&A[J]++):C&(t|i)&&(R===d||R===g)&&A[J]--:j&(e|i)&&(R===d||R===g)&&A[J]--,R=A[y]=X,j=C,J=y,E>65535&&y++)}return A}function S(w,A){const j=[];for(let J=0;J<A.length;J++){const y=A.codePointAt(J);y>65535&&J++,j.push(l.U.codeToGlyph(w,y))}const R=w.GSUB;if(R){const{lookupList:J,featureList:y}=R;let E;const C=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,X=[];y.forEach(z=>{if(C.test(z.tag))for(let q=0;q<z.tab.length;q++){if(X[z.tab[q]])continue;X[z.tab[q]]=!0;const ne=J[z.tab[q]],P=/^(isol|init|fina|medi)$/.test(z.tag);P&&!E&&(E=B(A));for(let G=0;G<j.length;G++)(!E||!P||m[E[G]]===z.tag)&&l.U._applySubs(j,G,ne,J)}})}return j}function T(w,A){const j=new Int16Array(A.length*3);let R=0;for(;R<A.length;R++){const C=A[R];if(C===-1)continue;j[R*3+2]=w.hmtx.aWidth[C];const X=w.GPOS;if(X){const z=X.lookupList;for(let q=0;q<z.length;q++){const ne=z[q];for(let P=0;P<ne.tabs.length;P++){const G=ne.tabs[P];if(ne.ltype===1){if(l._lctf.coverageIndex(G.coverage,C)!==-1&&G.pos){E(G.pos,R);break}}else if(ne.ltype===2){let v=null,x=J();if(x!==-1){const k=l._lctf.coverageIndex(G.coverage,A[x]);if(k!==-1){if(G.fmt===1){const D=G.pairsets[k];for(let U=0;U<D.length;U++)D[U].gid2===C&&(v=D[U])}else if(G.fmt===2){const D=l.U._getGlyphClass(A[x],G.classDef1),U=l.U._getGlyphClass(C,G.classDef2);v=G.matrix[D][U]}if(v){v.val1&&E(v.val1,x),v.val2&&E(v.val2,R);break}}}}else if(ne.ltype===4){const v=l._lctf.coverageIndex(G.markCoverage,C);if(v!==-1){const x=J(y),k=x===-1?-1:l._lctf.coverageIndex(G.baseCoverage,A[x]);if(k!==-1){const D=G.markArray[v],U=G.baseArray[k][D.markClass];j[R*3]=U.x-D.x+j[x*3]-j[x*3+2],j[R*3+1]=U.y-D.y+j[x*3+1];break}}}else if(ne.ltype===6){const v=l._lctf.coverageIndex(G.mark1Coverage,C);if(v!==-1){const x=J();if(x!==-1){const k=A[x];if(b(w,k)===3){const D=l._lctf.coverageIndex(G.mark2Coverage,k);if(D!==-1){const U=G.mark1Array[v],N=G.mark2Array[D][U.markClass];j[R*3]=N.x-U.x+j[x*3]-j[x*3+2],j[R*3+1]=N.y-U.y+j[x*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const z=J();if(z!==-1){const q=w.kern.glyph1.indexOf(A[z]);if(q!==-1){const ne=w.kern.rval[q].glyph2.indexOf(C);ne!==-1&&(j[z*3+2]+=w.kern.rval[q].vals[ne])}}}}return j;function J(C){for(let X=R-1;X>=0;X--)if(A[X]!==-1&&(!C||C(A[X])))return X;return-1}function y(C){return b(w,C)===1}function E(C,X){for(let z=0;z<3;z++)j[X*3+z]+=C[z]||0}}function b(w,A){const j=w.GDEF&&w.GDEF.glyphClassDef;return j?l.U._getGlyphClass(A,j):0}function F(...w){for(let A=0;A<w.length;A++)if(typeof w[A]=="number")return w[A]}function O(w){const A=Object.create(null),j=w["OS/2"],R=w.hhea,J=w.head.unitsPerEm,y=F(j&&j.sTypoAscender,R&&R.ascender,J),E={unitsPerEm:J,ascender:y,descender:F(j&&j.sTypoDescender,R&&R.descender,0),capHeight:F(j&&j.sCapHeight,y),xHeight:F(j&&j.sxHeight,y),lineGap:F(j&&j.sTypoLineGap,R&&R.lineGap),supportsCodePoint(C){return l.U.codeToGlyph(w,C)>0},forEachGlyph(C,X,z,q){let ne=0;const P=1/E.unitsPerEm*X,G=S(w,C);let v=0;const x=T(w,G);return G.forEach((k,D)=>{if(k!==-1){let U=A[k];if(!U){const{cmds:N,crds:M}=l.U.glyphToPath(w,k);let I="",Y=0;for(let ce=0,Z=N.length;ce<Z;ce++){const te=h[N[ce]];I+=N[ce];for(let le=1;le<=te;le++)I+=(le>1?",":"")+M[Y++]}let ee,H,W,me;if(M.length){ee=H=1/0,W=me=-1/0;for(let ce=0,Z=M.length;ce<Z;ce+=2){let te=M[ce],le=M[ce+1];te<ee&&(ee=te),le<H&&(H=le),te>W&&(W=te),le>me&&(me=le)}}else ee=W=H=me=0;U=A[k]={index:k,advanceWidth:w.hmtx.aWidth[k],xMin:ee,yMin:H,xMax:W,yMax:me,path:I}}q.call(null,U,ne+x[D*3]*P,x[D*3+1]*P,v),ne+=x[D*3+2]*P,z&&(ne+=z*X)}v+=C.codePointAt(v)>65535?2:1}),ne}};return E}return function(A){const j=new Uint8Array(A,0,4),R=l._bin.readASCII(j,0,4);if(R==="wOFF")A=r(A);else if(R==="wOF2")throw new Error("woff2 fonts not supported");return O(l.parse(A)[0])}}const co=gt({name:"Typr Font Parser",dependencies:[lo,fo,uo],init(l,r,h){const u=l(),t=r();return h(u,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function ho(){return function(l){var r=function(){this.buckets=new Map};r.prototype.add=function(T){var b=T>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&T))},r.prototype.has=function(T){var b=this.buckets.get(T>>5);return b!==void 0&&(b&1<<(31&T))!=0},r.prototype.serialize=function(){var T=[];return this.buckets.forEach(function(b,F){T.push((+F).toString(36)+":"+b.toString(36))}),T.join(",")},r.prototype.deserialize=function(T){var b=this;this.buckets.clear(),T.split(",").forEach(function(F){var O=F.split(":");b.buckets.set(parseInt(O[0],36),parseInt(O[1],36))})};var h=Math.pow(2,8),u=h-1,t=~u;function e(T){var b=function(O){return O&t}(T).toString(16),F=function(O){return(O&t)+h-1}(T).toString(16);return"codepoint-index/plane"+(T>>16)+"/"+b+"-"+F+".json"}function a(T,b){var F=T&u,O=b.codePointAt(F/6|0);return((O=(O||48)-48)&1<<F%6)!=0}function o(T,b){var F;(F=T,F.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(O){return O.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(O){var w=O[0],A=O[1];A===void 0&&(A=w),b(w,A)})}function n(T,b){o(T,function(F,O){for(var w=F;w<=O;w++)b(w)})}var i={},s={},f=new WeakMap,c="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(T){var b=f.get(T);return b||(b=new r,n(T.ranges,function(F){return b.add(F)}),f.set(T,b)),b}var p,g=new Map;function m(T,b,F){return T[b]?b:T[F]?F:function(O){for(var w in O)return w}(T)}function B(T,b){var F=b;if(!T.includes(F)){F=1/0;for(var O=0;O<T.length;O++)Math.abs(T[O]-b)<Math.abs(F-b)&&(F=T[O])}return F}function S(T){return p||(p=new Set,n("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(b){p.add(b)})),p.has(T)}return l.CodePointSet=r,l.clearCache=function(){i={},s={}},l.getFontsForString=function(T,b){b===void 0&&(b={});var F,O=b.lang;O===void 0&&(O=new RegExp("\\p{Script=Hangul}","u").test(F=T)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(F)?"ja":"en");var w=b.category;w===void 0&&(w="sans-serif");var A=b.style;A===void 0&&(A="normal");var j=b.weight;j===void 0&&(j=400);var R=(b.dataUrl||c).replace(/\/$/g,""),J=new Map,y=new Uint8Array(T.length),E={},C={},X=new Array(T.length),z=new Map,q=!1;function ne(v){var x=g.get(v);return x||(x=fetch(R+"/"+v).then(function(k){if(!k.ok)throw new Error(k.statusText);return k.json().then(function(D){if(!Array.isArray(D)||D[0]!==1)throw new Error("Incorrect schema version; need 1, got "+D[0]);return D[1]})}).catch(function(k){if(R!==c)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+R+'", trying default CDN. '+k.message),q=!0),R=c,g.delete(v),ne(v);throw k}),g.set(v,x)),x}for(var P=function(v){var x=T.codePointAt(v),k=e(x);X[v]=k,i[k]||z.has(k)||z.set(k,ne(k).then(function(D){i[k]=D})),x>65535&&(v++,G=v)},G=0;G<T.length;G++)P(G);return Promise.all(z.values()).then(function(){z.clear();for(var v=function(k){var D=T.codePointAt(k),U=null,N=i[X[k]],M=void 0;for(var I in N){var Y=C[I];if(Y===void 0&&(Y=C[I]=new RegExp(I).test(O||"en")),Y){for(var ee in M=I,N[I])if(a(D,N[I][ee])){U=ee;break}break}}if(!U){e:for(var H in N)if(H!==M){for(var W in N[H])if(a(D,N[H][W])){U=W;break e}}}U||(console.debug("No font coverage for U+"+D.toString(16)),U="latin"),X[k]=U,s[U]||z.has(U)||z.set(U,ne("font-meta/"+U+".json").then(function(me){s[U]=me})),D>65535&&(k++,x=k)},x=0;x<T.length;x++)v(x);return Promise.all(z.values())}).then(function(){for(var v,x=null,k=0;k<T.length;k++){var D=T.codePointAt(k);if(x&&(S(D)||d(x).has(D)))y[k]=y[k-1];else{x=s[X[k]];var U=E[x.id];if(!U){var N=x.typeforms,M=m(N,w,"sans-serif"),I=m(N[M],A,"normal"),Y=B((v=N[M])===null||v===void 0?void 0:v[I],j);U=E[x.id]=R+"/font-files/"+x.id+"/"+M+"."+I+"."+Y+".woff"}var ee=J.get(U);ee==null&&(ee=J.size,J.set(U,ee)),y[k]=ee}D>65535&&(k++,y[k]=y[k-1])}return{fontUrls:Array.from(J.keys()),chars:y}})},Object.defineProperty(l,"__esModule",{value:!0}),l}({})}function vo(l,r){const h=Object.create(null),u=Object.create(null);function t(a,o){const n=i=>{console.error(`Failure loading font ${a}`,i)};try{const i=new XMLHttpRequest;i.open("get",a,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)n(new Error(i.statusText));else if(i.status>0)try{const s=l(i.response);s.src=a,o(s)}catch(s){n(s)}},i.onerror=n,i.send()}catch(i){n(i)}}function e(a,o){let n=h[a];n?o(n):u[a]?u[a].push(o):(u[a]=[o],t(a,i=>{i.src=a,h[a]=i,u[a].forEach(s=>s(i)),delete u[a]}))}return function(a,o,{lang:n,fonts:i=[],style:s="normal",weight:f="normal",unicodeFontsURL:c}={}){const d=new Uint8Array(a.length),p=[];a.length||S();const g=new Map,m=[];if(s!=="italic"&&(s="normal"),typeof f!="number"&&(f=f==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(b=>!b.lang||b.lang.test(n)).reverse(),i.length){let w=0;(function A(j=0){for(let R=j,J=a.length;R<J;R++){const y=a.codePointAt(R);if(w===1&&p[d[R-1]].supportsCodePoint(y)||/\s/.test(a[R]))d[R]=d[R-1],w===2&&(m[m.length-1][1]=R);else for(let E=d[R],C=i.length;E<=C;E++)if(E===C){const X=w===2?m[m.length-1]:m[m.length]=[R,R];X[1]=R,w=2}else{d[R]=E;const{src:X,unicodeRange:z}=i[E];if(!z||T(y,z)){const q=h[X];if(!q){e(X,()=>{A(R)});return}if(q.supportsCodePoint(y)){let ne=g.get(q);typeof ne!="number"&&(ne=p.length,p.push(q),g.set(q,ne)),d[R]=ne,w=1;break}}}y>65535&&R+1<J&&(d[R+1]=d[R],R++,w===2&&(m[m.length-1][1]=R))}B()})()}else m.push([0,a.length-1]),B();function B(){if(m.length){const b=m.map(F=>a.substring(F[0],F[1]+1)).join(`
`);r.getFontsForString(b,{lang:n||void 0,style:s,weight:f,dataUrl:c}).then(({fontUrls:F,chars:O})=>{const w=p.length;let A=0;m.forEach(R=>{for(let J=0,y=R[1]-R[0];J<=y;J++)d[R[0]+J]=O[A++]+w;A++});let j=0;F.forEach((R,J)=>{e(R,y=>{p[J+w]=y,++j===F.length&&S()})})})}else S()}function S(){o({chars:d,fonts:p})}function T(b,F){for(let O=0;O<F.length;O++){const[w,A=w]=F[O];if(w<=b&&b<=A)return!0}return!1}}}const po=gt({name:"FontResolver",dependencies:[vo,co,ho],init(l,r,h){return l(r,h())}});function go(l,r){const u=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:p,lang:g,fonts:m,style:B,weight:S,preResolvedFonts:T,unicodeFontsURL:b},F){const O=({chars:w,fonts:A})=>{let j,R;const J=[];for(let y=0;y<w.length;y++)w[y]!==R?(R=w[y],J.push(j={start:y,end:y,fontObj:A[w[y]]})):j.end=y;F(J)};T?O(T):l(p,O,{lang:g,fonts:m,style:B,weight:S,unicodeFontsURL:b})}function o({text:p="",font:g,lang:m,sdfGlyphSize:B=64,fontSize:S=400,fontWeight:T=1,fontStyle:b="normal",letterSpacing:F=0,lineHeight:O="normal",maxWidth:w=1/0,direction:A,textAlign:j="left",textIndent:R=0,whiteSpace:J="normal",overflowWrap:y="normal",anchorX:E=0,anchorY:C=0,metricsOnly:X=!1,unicodeFontsURL:z,preResolvedFonts:q=null,includeCaretPositions:ne=!1,chunkedBoundsSize:P=8192,colorRanges:G=null},v){const x=f(),k={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,F=+F,w=+w,O=O||"normal",R=+R,a({text:p,lang:m,style:b,weight:T,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:z,preResolvedFonts:q},D=>{k.fontLoad=f()-x;const U=isFinite(w);let N=null,M=null,I=null,Y=null,ee=null,H=null,W=null,me=null,ce=0,Z=0,te=J!=="nowrap";const le=new Map,V=f();let re=R,$=0,L=new c;const de=[L];D.forEach(ae=>{const{fontObj:ie}=ae,{ascender:ue,descender:pe,unitsPerEm:_e,lineGap:Ae,capHeight:ye,xHeight:xe}=ie;let fe=le.get(ie);if(!fe){const he=S/_e,Se=O==="normal"?(ue-pe+Ae)*he:O*S,Qe=(Se-(ue-pe)*he)/2,we=Math.min(Se,(ue-pe)*he),be=(ue+pe)/2*he+we/2;fe={index:le.size,src:ie.src,fontObj:ie,fontSizeMult:he,unitsPerEm:_e,ascender:ue*he,descender:pe*he,capHeight:ye*he,xHeight:xe*he,lineHeight:Se,baseline:-Qe-ue*he,caretTop:be,caretBottom:be-we},le.set(ie,fe)}const{fontSizeMult:De}=fe,Te=p.slice(ae.start,ae.end+1);let Le,ke;ie.forEachGlyph(Te,S,F,(he,Se,Qe,we)=>{Se+=$,we+=ae.start,Le=Se,ke=he;const be=p.charAt(we),Ee=he.advanceWidth*De,Fe=L.count;let ge;if("isEmpty"in he||(he.isWhitespace=!!be&&new RegExp(t).test(be),he.canBreakAfter=!!be&&e.test(be),he.isEmpty=he.xMin===he.xMax||he.yMin===he.yMax||u.test(be)),!he.isWhitespace&&!he.isEmpty&&Z++,te&&U&&!he.isWhitespace&&Se+Ee+re>w&&Fe){if(L.glyphAt(Fe-1).glyphObj.canBreakAfter)ge=new c,re=-Se;else for(let Be=Fe;Be--;)if(Be===0&&y==="break-word"){ge=new c,re=-Se;break}else if(L.glyphAt(Be).glyphObj.canBreakAfter){ge=L.splitAt(Be+1);const Re=ge.glyphAt(0).x;re-=Re;for(let Me=ge.count;Me--;)ge.glyphAt(Me).x-=Re;break}ge&&(L.isSoftWrapped=!0,L=ge,de.push(L),ce=w)}let Ce=L.glyphAt(L.count);Ce.glyphObj=he,Ce.x=Se+re,Ce.y=Qe,Ce.width=Ee,Ce.charIndex=we,Ce.fontData=fe,be===`
`&&(L=new c,de.push(L),re=-(Se+Ee+F*S)+R)}),$=Le+ke.advanceWidth*De+F*S});let Q=0;de.forEach(ae=>{let ie=!0;for(let ue=ae.count;ue--;){const pe=ae.glyphAt(ue);ie&&!pe.glyphObj.isWhitespace&&(ae.width=pe.x+pe.width,ae.width>ce&&(ce=ae.width),ie=!1);let{lineHeight:_e,capHeight:Ae,xHeight:ye,baseline:xe}=pe.fontData;_e>ae.lineHeight&&(ae.lineHeight=_e);const fe=xe-ae.baseline;fe<0&&(ae.baseline+=fe,ae.cap+=fe,ae.ex+=fe),ae.cap=Math.max(ae.cap,ae.baseline+Ae),ae.ex=Math.max(ae.ex,ae.baseline+ye)}ae.baseline-=Q,ae.cap-=Q,ae.ex-=Q,Q+=ae.lineHeight});let oe=0,K=0;if(E&&(typeof E=="number"?oe=-E:typeof E=="string"&&(oe=-ce*(E==="left"?0:E==="center"?.5:E==="right"?1:i(E)))),C&&(typeof C=="number"?K=-C:typeof C=="string"&&(K=C==="top"?0:C==="top-baseline"?-de[0].baseline:C==="top-cap"?-de[0].cap:C==="top-ex"?-de[0].ex:C==="middle"?Q/2:C==="bottom"?Q:C==="bottom-baseline"?-de[de.length-1].baseline:i(C)*Q)),!X){const ae=r.getEmbeddingLevels(p,A);N=new Uint16Array(Z),M=new Uint8Array(Z),I=new Float32Array(Z*2),Y={},W=[1/0,1/0,-1/0,-1/0],me=[],ne&&(H=new Float32Array(p.length*4)),G&&(ee=new Uint8Array(Z*3));let ie=0,ue=-1,pe=-1,_e,Ae;if(de.forEach((ye,xe)=>{let{count:fe,width:De}=ye;if(fe>0){let Te=0;for(let we=fe;we--&&ye.glyphAt(we).glyphObj.isWhitespace;)Te++;let Le=0,ke=0;if(j==="center")Le=(ce-De)/2;else if(j==="right")Le=ce-De;else if(j==="justify"&&ye.isSoftWrapped){let we=0;for(let be=fe-Te;be--;)ye.glyphAt(be).glyphObj.isWhitespace&&we++;ke=(ce-De)/we}if(ke||Le){let we=0;for(let be=0;be<fe;be++){let Ee=ye.glyphAt(be);const Fe=Ee.glyphObj;Ee.x+=Le+we,ke!==0&&Fe.isWhitespace&&be<fe-Te&&(we+=ke,Ee.width+=ke)}}const he=r.getReorderSegments(p,ae,ye.glyphAt(0).charIndex,ye.glyphAt(ye.count-1).charIndex);for(let we=0;we<he.length;we++){const[be,Ee]=he[we];let Fe=1/0,ge=-1/0;for(let Ce=0;Ce<fe;Ce++)if(ye.glyphAt(Ce).charIndex>=be){let Be=Ce,Re=Ce;for(;Re<fe;Re++){let Me=ye.glyphAt(Re);if(Me.charIndex>Ee)break;Re<fe-Te&&(Fe=Math.min(Fe,Me.x),ge=Math.max(ge,Me.x+Me.width))}for(let Me=Be;Me<Re;Me++){const Ne=ye.glyphAt(Me);Ne.x=ge-(Ne.x+Ne.width-Fe)}break}}let Se;const Qe=we=>Se=we;for(let we=0;we<fe;we++){const be=ye.glyphAt(we);Se=be.glyphObj;const Ee=Se.index,Fe=ae.levels[be.charIndex]&1;if(Fe){const ge=r.getMirroredCharacter(p[be.charIndex]);ge&&be.fontData.fontObj.forEachGlyph(ge,0,0,Qe)}if(ne){const{charIndex:ge,fontData:Ce}=be,Be=be.x+oe,Re=be.x+be.width+oe;H[ge*4]=Fe?Re:Be,H[ge*4+1]=Fe?Be:Re,H[ge*4+2]=ye.baseline+Ce.caretBottom+K,H[ge*4+3]=ye.baseline+Ce.caretTop+K;const Me=ge-ue;Me>1&&s(H,ue,Me),ue=ge}if(G){const{charIndex:ge}=be;for(;ge>pe;)pe++,G.hasOwnProperty(pe)&&(Ae=G[pe])}if(!Se.isWhitespace&&!Se.isEmpty){const ge=ie++,{fontSizeMult:Ce,src:Be,index:Re}=be.fontData,Me=Y[Be]||(Y[Be]={});Me[Ee]||(Me[Ee]={path:Se.path,pathBounds:[Se.xMin,Se.yMin,Se.xMax,Se.yMax]});const Ne=be.x+oe,Ze=be.y+ye.baseline+K;I[ge*2]=Ne,I[ge*2+1]=Ze;const Ye=Ne+Se.xMin*Ce,qe=Ze+Se.yMin*Ce,tt=Ne+Se.xMax*Ce,Ke=Ze+Se.yMax*Ce;Ye<W[0]&&(W[0]=Ye),qe<W[1]&&(W[1]=qe),tt>W[2]&&(W[2]=tt),Ke>W[3]&&(W[3]=Ke),ge%P===0&&(_e={start:ge,end:ge,rect:[1/0,1/0,-1/0,-1/0]},me.push(_e)),_e.end++;const Oe=_e.rect;if(Ye<Oe[0]&&(Oe[0]=Ye),qe<Oe[1]&&(Oe[1]=qe),tt>Oe[2]&&(Oe[2]=tt),Ke>Oe[3]&&(Oe[3]=Ke),N[ge]=Ee,M[ge]=Re,G){const rt=ge*3;ee[rt]=Ae>>16&255,ee[rt+1]=Ae>>8&255,ee[rt+2]=Ae&255}}}}}),H){const ye=p.length-ue;ye>1&&s(H,ue,ye)}}const Ue=[];le.forEach(({index:ae,src:ie,unitsPerEm:ue,ascender:pe,descender:_e,lineHeight:Ae,capHeight:ye,xHeight:xe})=>{Ue[ae]={src:ie,unitsPerEm:ue,ascender:pe,descender:_e,lineHeight:Ae,capHeight:ye,xHeight:xe}}),k.typesetting=f()-V,v({glyphIds:N,glyphFontIndices:M,glyphPositions:I,glyphData:Y,fontData:Ue,caretPositions:H,glyphColors:ee,chunkedBounds:me,fontSize:S,topBaseline:K+de[0].baseline,blockBounds:[oe,K-Q,oe+ce,K],visibleBounds:W,timings:k})})}function n(p,g){o({...p,metricsOnly:!0},m=>{const[B,S,T,b]=m.blockBounds;g({width:T-B,height:b-S})})}function i(p){let g=p.match(/^([\d.]+)%$/),m=g?parseFloat(g[1]):NaN;return isNaN(m)?0:m/100}function s(p,g,m){const B=p[g*4],S=p[g*4+1],T=p[g*4+2],b=p[g*4+3],F=(S-B)/m;for(let O=0;O<m;O++){const w=(g+O)*4;p[w]=B+F*O,p[w+1]=B+F*(O+1),p[w+2]=T,p[w+3]=b}}function f(){return(self.performance||Date).now()}function c(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return c.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(p){let g=c.flyweight;return g.data=this.data,g.index=p,g},splitAt(p){let g=new c;return g.data=this.data.splice(p*d.length),g}},c.flyweight=d.reduce((p,g,m,B)=>(Object.defineProperty(p,g,{get(){return this.data[this.index*d.length+m]},set(S){this.data[this.index*d.length+m]=S}}),p),{data:null,index:0}),{typeset:o,measure:n}}const ot=()=>(self.performance||Date).now(),$t=Xn();let Fn;function mo(l,r,h,u,t,e,a,o,n,i,s=!0){return s?xo(l,r,h,u,t,e,a,o,n,i).then(null,f=>(Fn||(console.warn("WebGL SDF generation failed, falling back to JS",f),Fn=!0),An(l,r,h,u,t,e,a,o,n,i))):An(l,r,h,u,t,e,a,o,n,i)}const Qt=[],yo=5;let Dr=0;function Kn(){const l=ot();for(;Qt.length&&ot()-l<yo;)Qt.shift()();Dr=Qt.length?setTimeout(Kn,0):0}const xo=(...l)=>new Promise((r,h)=>{Qt.push(()=>{const u=ot();try{$t.webgl.generateIntoCanvas(...l),r({timing:ot()-u})}catch(t){h(t)}}),Dr||(Dr=setTimeout(Kn,0))}),bo=4,Uo=2e3,Cn={};let So=0;function An(l,r,h,u,t,e,a,o,n,i){const s="TroikaTextSDFGenerator_JS_"+So++%bo;let f=Cn[s];return f||(f=Cn[s]={workerModule:gt({name:s,workerId:s,dependencies:[Xn,ot],init(c,d){const p=c().javascript.generate;return function(...g){const m=d();return{textureData:p(...g),timing:d()-m}}},getTransferables(c){return[c.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(l,r,h,u,t,e).then(({textureData:c,timing:d})=>{const p=ot(),g=new Uint8Array(c.length*4);for(let m=0;m<c.length;m++)g[m*4+i]=c[m];return $t.webglUtils.renderImageData(a,g,o,n,l,r,1<<3-i),d+=ot()-p,--f.requests===0&&(f.idleTimer=setTimeout(()=>{qa(s)},Uo)),{timing:d}})}function wo(l){l._warm||($t.webgl.isSupported(l),l._warm=!0)}const _o=$t.webglUtils.resizeWebGLCanvasWithoutClearing,ct={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},ko=new qt;function ut(){return(self.performance||Date).now()}const Dn=Object.create(null);function Jn(l,r){l=Co({},l);const h=ut(),{defaultFontURL:u}=ct,t=[];if(u&&t.push({label:"default",src:En(u)}),l.font&&t.push({label:"user",src:En(l.font)}),l.font=t,l.text=""+l.text,l.sdfGlyphSize=l.sdfGlyphSize||ct.sdfGlyphSize,l.unicodeFontsURL=l.unicodeFontsURL||ct.unicodeFontsURL,l.colorRanges!=null){let c={};for(let d in l.colorRanges)if(l.colorRanges.hasOwnProperty(d)){let p=l.colorRanges[d];typeof p!="number"&&(p=ko.set(p).getHex()),c[d]=p}l.colorRanges=c}Object.freeze(l);const{textureWidth:e,sdfExponent:a}=ct,{sdfGlyphSize:o}=l,n=e/o*4;let i=Dn[o];if(!i){const c=document.createElement("canvas");c.width=e,c.height=o*256/n,i=Dn[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:c,sdfTexture:new Tr(c,void 0,void 0,void 0,bn,bn),contextLost:!1,glyphsByFont:new Map},i.sdfTexture.generateMipmaps=!1,To(i)}const{sdfTexture:s,sdfCanvas:f}=i;Do(l).then(c=>{const{glyphIds:d,glyphFontIndices:p,fontData:g,glyphPositions:m,fontSize:B,timings:S}=c,T=[],b=new Float32Array(d.length*4);let F=0,O=0;const w=ut(),A=g.map(E=>{let C=i.glyphsByFont.get(E.src);return C||i.glyphsByFont.set(E.src,C=new Map),C});d.forEach((E,C)=>{const X=p[C],{src:z,unitsPerEm:q}=g[X];let ne=A[X].get(E);if(!ne){const{path:k,pathBounds:D}=c.glyphData[z][E],U=Math.max(D[2]-D[0],D[3]-D[1])/o*(ct.sdfMargin*o+.5),N=i.glyphCount++,M=[D[0]-U,D[1]-U,D[2]+U,D[3]+U];A[X].set(E,ne={path:k,atlasIndex:N,sdfViewBox:M}),T.push(ne)}const{sdfViewBox:P}=ne,G=m[O++],v=m[O++],x=B/q;b[F++]=G+P[0]*x,b[F++]=v+P[1]*x,b[F++]=G+P[2]*x,b[F++]=v+P[3]*x,d[C]=ne.atlasIndex}),S.quads=(S.quads||0)+(ut()-w);const j=ut();S.sdf={};const R=f.height,J=Math.ceil(i.glyphCount/n),y=Math.pow(2,Math.ceil(Math.log2(J*o)));y>R&&(console.info(`Increasing SDF texture size ${R}->${y}`),_o(f,e,y),s.dispose()),Promise.all(T.map(E=>Qn(E,i,l.gpuAccelerateSDF).then(({timing:C})=>{S.sdf[E.atlasIndex]=C}))).then(()=>{T.length&&!i.contextLost&&(Zn(i),s.needsUpdate=!0),S.sdfTotal=ut()-j,S.total=ut()-h,r(Object.freeze({parameters:l,sdfTexture:s,sdfGlyphSize:o,sdfExponent:a,glyphBounds:b,glyphAtlasIndices:d,glyphColors:c.glyphColors,caretPositions:c.caretPositions,chunkedBounds:c.chunkedBounds,ascender:c.ascender,descender:c.descender,lineHeight:c.lineHeight,capHeight:c.capHeight,xHeight:c.xHeight,topBaseline:c.topBaseline,blockBounds:c.blockBounds,visibleBounds:c.visibleBounds,timings:c.timings}))})}),Promise.resolve().then(()=>{i.contextLost||wo(f)})}function Qn({path:l,atlasIndex:r,sdfViewBox:h},{sdfGlyphSize:u,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:n}=ct,i=Math.max(h[2]-h[0],h[3]-h[1]),s=Math.floor(r/4),f=s%(o/u)*u,c=Math.floor(s/(o/u))*u,d=r%4;return mo(u,u,l,h,i,n,t,f,c,d,a)}function To(l){const r=l.sdfCanvas;r.addEventListener("webglcontextlost",h=>{console.log("Context Lost",h),h.preventDefault(),l.contextLost=!0}),r.addEventListener("webglcontextrestored",h=>{console.log("Context Restored",h),l.contextLost=!1;const u=[];l.glyphsByFont.forEach(t=>{t.forEach(e=>{u.push(Qn(e,l,!0))})}),Promise.all(u).then(()=>{Zn(l),l.sdfTexture.needsUpdate=!0})})}function Fo({font:l,characters:r,sdfGlyphSize:h},u){let t=Array.isArray(r)?r.join(`
`):""+r;Jn({font:l,sdfGlyphSize:h,text:t},u)}function Co(l,r){for(let h in r)r.hasOwnProperty(h)&&(l[h]=r[h]);return l}let Xt;function En(l){return Xt||(Xt=typeof document>"u"?{}:document.createElement("a")),Xt.href=l,Xt.href}function Zn(l){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:h}=l,{width:u,height:t}=r,e=l.sdfCanvas.getContext("webgl");let a=h.image.data;(!a||a.length!==u*t*4)&&(a=new Uint8Array(u*t*4),h.image={width:u,height:t,data:a},h.flipY=!1,h.isDataTexture=!0),e.readPixels(0,0,u,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const Ao=gt({name:"Typesetter",dependencies:[go,po,eo],init(l,r,h){return l(r,h())}}),Do=gt({name:"Typesetter",dependencies:[Ao],init(l){return function(r){return new Promise(h=>{l.typeset(r,h)})}},getTransferables(l){const r=[];for(let h in l)l[h]&&l[h].buffer&&r.push(l[h].buffer);return r}}),Mn={};function Eo(l){let r=Mn[l];if(!r){const h=new Wr(1,1,l,l),u=h.clone(),t=h.attributes,e=u.attributes,a=new Na,o=t.uv.count;for(let n=0;n<o;n++)e.position.array[n*3]*=-1,e.normal.array[n*3+2]*=-1;["position","normal","uv"].forEach(n=>{a.setAttribute(n,new Wa([...t[n].array,...e[n].array],t[n].itemSize))}),a.setIndex([...h.index.array,...u.index.array.map(n=>n+o)]),a.translate(.5,.5,0),r=Mn[l]=a}return r}const Mo="aTroikaGlyphBounds",Gn="aTroikaGlyphIndex",Go="aTroikaGlyphColor";class Ro extends Ra{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ba,this.boundingBox=new Wn}computeBoundingSphere(){}computeBoundingBox(){}setSide(r){const h=this.getIndex().count;this.setDrawRange(r===Oa?h/2:0,r===zn?h:h/2)}set detail(r){if(r!==this._detail){this._detail=r,(typeof r!="number"||r<1)&&(r=1);let h=Eo(r);["position","normal","uv"].forEach(u=>{this.attributes[u]=h.attributes[u].clone()}),this.setIndex(h.getIndex().clone())}}get detail(){return this._detail}set curveRadius(r){r!==this._curveRadius&&(this._curveRadius=r,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(r,h,u,t,e){Ur(this,Mo,r,4),Ur(this,Gn,h,1),Ur(this,Go,e,3),this._blockBounds=u,this._chunkedBounds=t,this.instanceCount=h.length,this._updateBounds()}_updateBounds(){const r=this._blockBounds;if(r){const{curveRadius:h,boundingBox:u}=this;if(h){const{PI:t,floor:e,min:a,max:o,sin:n,cos:i}=Math,s=t/2,f=t*2,c=Math.abs(h),d=r[0]/c,p=r[2]/c,g=e((d+s)/f)!==e((p+s)/f)?-c:a(n(d)*c,n(p)*c),m=e((d-s)/f)!==e((p-s)/f)?c:o(n(d)*c,n(p)*c),B=e((d+t)/f)!==e((p+t)/f)?c*2:o(c-i(d)*c,c-i(p)*c);u.min.set(g,r[1],h<0?-B:0),u.max.set(m,r[3],h<0?0:B)}else u.min.set(r[0],r[1],0),u.max.set(r[2],r[3],0);u.getBoundingSphere(this.boundingSphere)}}applyClipRect(r){let h=this.getAttribute(Gn).count,u=this._chunkedBounds;if(u)for(let t=u.length;t--;){h=u[t].end;let e=u[t].rect;if(e[1]<r.w&&e[3]>r.y&&e[0]<r.z&&e[2]>r.x)break}this.instanceCount=h}}function Ur(l,r,h,u){const t=l.getAttribute(r);h?t&&t.array.length===h.length?(t.array.set(h),t.needsUpdate=!0):(l.setAttribute(r,new La(h,u)),delete l._maxInstanceCount,l.dispose()):t&&l.deleteAttribute(r)}const Bo=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Oo=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Lo=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Po=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Io(l){const r=Ar(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new vt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Un(0,0,0,0)},uTroikaClipRect:{value:new Un(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new vt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new qt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Pa},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Bo,vertexTransform:Oo,fragmentDefs:Lo,fragmentColorTransform:Po,customRewriter({vertexShader:h,fragmentShader:u}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(u)&&(u=u.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(h)||(h=h.replace(Yn,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:h,fragmentShader:u}}});return r.transparent=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const Hr=new Ia({color:16777215,side:zn,transparent:!0}),Rn=8421504,Bn=new ja,Yt=new Nr,Sr=new Nr,Ft=[],jo=new Nr,wr="+x+y";function On(l){return Array.isArray(l)?l[0]:l}let qn=()=>{const l=new jr(new Wr(1,1),Hr);return qn=()=>l,l},$n=()=>{const l=new jr(new Wr(1,1,32,1),Hr);return $n=()=>l,l};const No={type:"syncstart"},Wo={type:"synccomplete"},ea=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],zo=ea.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let ta=class extends jr{constructor(){const r=new Ro;super(r,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Rn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=wr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(r){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(r):(this._isSyncing=!0,this.dispatchEvent(No),Jn({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},h=>{this._isSyncing=!1,this._textRenderInfo=h,this.geometry.updateGlyphs(h.glyphBounds,h.glyphAtlasIndices,h.blockBounds,h.chunkedBounds,h.glyphColors);const u=this._queuedSyncs;u&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{u.forEach(t=>t&&t())})),this.dispatchEvent(Wo),r&&r()})))}onBeforeRender(r,h,u,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e),e._hadOwnSide=e.hasOwnProperty("side"),this.geometry.setSide(e._actualSide=e.side),e.side=Ga}onAfterRender(r,h,u,t,e,a){e._hadOwnSide?e.side=e._actualSide:delete e.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let r=this._derivedMaterial;const h=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Hr.clone());if((!r||r.baseMaterial!==h)&&(r=this._derivedMaterial=Io(h),h.addEventListener("dispose",function u(){h.removeEventListener("dispose",u),r.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let u=r._outlineMtl;return u||(u=r._outlineMtl=Object.create(r,{id:{value:r.id+.1}}),u.isTextOutlineMaterial=!0,u.depthWrite=!1,u.map=null,r.addEventListener("dispose",function t(){r.removeEventListener("dispose",t),u.dispose()})),[u,r]}else return r}set material(r){r&&r.isTroikaTextMaterial?(this._derivedMaterial=r,this._baseMaterial=r.baseMaterial):this._baseMaterial=r}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(r){this.geometry.detail=r}get curveRadius(){return this.geometry.curveRadius}set curveRadius(r){this.geometry.curveRadius=r}get customDepthMaterial(){return On(this.material).getDepthMaterial()}get customDistanceMaterial(){return On(this.material).getDistanceMaterial()}_prepareForRender(r){const h=r.isTextOutlineMaterial,u=r.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:o,blockBounds:n}=t;u.uTroikaSDFTexture.value=o,u.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),u.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,u.uTroikaSDFExponent.value=t.sdfExponent,u.uTroikaTotalBounds.value.fromArray(n),u.uTroikaUseGlyphColors.value=!h&&!!t.glyphColors;let i=0,s=0,f=0,c,d,p,g=0,m=0;if(h){let{outlineWidth:S,outlineOffsetX:T,outlineOffsetY:b,outlineBlur:F,outlineOpacity:O}=this;i=this._parsePercent(S)||0,s=Math.max(0,this._parsePercent(F)||0),c=O,g=this._parsePercent(T)||0,m=this._parsePercent(b)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(p=this.strokeColor,u.uTroikaStrokeColor.value.set(p??Rn),d=this.strokeOpacity,d==null&&(d=1)),c=this.fillOpacity;u.uTroikaDistanceOffset.value=i,u.uTroikaPositionOffset.value.set(g,m),u.uTroikaBlurRadius.value=s,u.uTroikaStrokeWidth.value=f,u.uTroikaStrokeOpacity.value=d,u.uTroikaFillOpacity.value=c??1,u.uTroikaCurveRadius.value=this.curveRadius||0;let B=this.clipRect;if(B&&Array.isArray(B)&&B.length===4)u.uTroikaClipRect.value.fromArray(B);else{const S=(this.fontSize||.1)*100;u.uTroikaClipRect.value.set(n[0]-S,n[1]-S,n[2]+S,n[3]+S)}this.geometry.applyClipRect(u.uTroikaClipRect.value)}u.uTroikaSDFDebug.value=!!this.debugSDF,r.polygonOffset=!!this.depthOffset,r.polygonOffsetFactor=r.polygonOffsetUnits=this.depthOffset||0;const e=h?this.outlineColor||0:this.color;if(e==null)delete r.color;else{const o=r.hasOwnProperty("color")?r.color:r.color=new qt;(e!==o._input||typeof e=="object")&&o.set(o._input=e)}let a=this.orientation||wr;if(a!==r._orientation){let o=u.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let n=a!==wr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,f,c]=n;Yt.set(0,0,0)[s]=i==="-"?1:-1,Sr.set(0,0,0)[c]=f==="-"?-1:1,Bn.lookAt(jo,Yt.cross(Sr),Sr),o.setFromMatrix4(Bn)}else o.identity();r._orientation=a}}_parsePercent(r){if(typeof r=="string"){let h=r.match(/^(-?[\d.]+)%$/),u=h?parseFloat(h[1]):NaN;r=(isNaN(u)?0:u/100)*this.fontSize}return r}localPositionToTextCoords(r,h=new vt){h.copy(r);const u=this.curveRadius;return u&&(h.x=Math.atan2(r.x,Math.abs(u)-Math.abs(r.z))*Math.abs(u)),h}worldPositionToTextCoords(r,h=new vt){return Yt.copy(r),this.localPositionToTextCoords(this.worldToLocal(Yt),h)}raycast(r,h){const{textRenderInfo:u,curveRadius:t}=this;if(u){const e=u.blockBounds,a=t?$n():qn(),o=a.geometry,{position:n,uv:i}=o.attributes;for(let s=0;s<i.count;s++){let f=e[0]+i.getX(s)*(e[2]-e[0]);const c=e[1]+i.getY(s)*(e[3]-e[1]);let d=0;t&&(d=t-Math.cos(f/t)*t,f=Math.sin(f/t)*t),n.setXYZ(s,f,c,d)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Ft.length=0,a.raycast(r,Ft);for(let s=0;s<Ft.length;s++)Ft[s].object=this,h.push(Ft[s])}}copy(r){const h=this.geometry;return super.copy(r),this.geometry=h,zo.forEach(u=>{this[u]=r[u]}),this}clone(){return new this.constructor().copy(this)}};ea.forEach(l=>{const r="_private_"+l;Object.defineProperty(ta.prototype,l,{get(){return this[r]},set(h){h!==this[r]&&(this[r]=h,this._needsSync=!0)}})});const Vo=ve.forwardRef(({sdfGlyphSize:l=64,anchorX:r="center",anchorY:h="middle",font:u,fontSize:t=1,children:e,characters:a,onSync:o,...n},i)=>{const s=Mt(({invalidate:p})=>p),[f]=ve.useState(()=>new ta),[c,d]=ve.useMemo(()=>{const p=[];let g="";return ve.Children.forEach(e,m=>{typeof m=="string"||typeof m=="number"?g+=m:p.push(m)}),[p,g]},[e]);return za(()=>new Promise(p=>Fo({font:u,characters:a},p)),["troika-text",u,a]),ve.useLayoutEffect(()=>void f.sync(()=>{s(),o&&o(f)})),ve.useEffect(()=>()=>f.dispose(),[f]),ve.createElement("primitive",dt({object:f,ref:i,font:u,text:d,anchorX:r,anchorY:h,fontSize:t,sdfGlyphSize:l},n),c)}),_r=l=>l===Object(l)&&!Array.isArray(l)&&typeof l!="function";function Xr(l,r){const h=Mt(e=>e.gl),u=zr(Vr,_r(l)?Object.values(l):l);return ve.useLayoutEffect(()=>{r==null||r(u)},[r]),ve.useEffect(()=>{if("initTexture"in h){let e=[];Array.isArray(u)?e=u:u instanceof Tr?e=[u]:_r(u)&&(e=Object.values(u)),e.forEach(a=>{a instanceof Tr&&h.initTexture(a)})}},[h,u]),ve.useMemo(()=>{if(_r(l)){const e={};let a=0;for(const o in l)e[o]=u[a++];return e}else return u},[l,u])}Xr.preload=l=>zr.preload(Vr,l);Xr.clear=l=>zr.clear(Vr,l);const Ho=()=>parseInt(Va.replace(/\D+/g,"")),Xo=Ho(),Ln=Xa({color:new qt("white"),scale:new vt(1,1),imageBounds:new vt(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${Xo>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),ra=ve.forwardRef(({children:l,color:r,segments:h=1,scale:u=1,zoom:t=1,grayscale:e=0,opacity:a=1,radius:o=0,texture:n,toneMapped:i,transparent:s,side:f,...c},d)=>{Ha({ImageMaterial:Ln});const p=ve.useRef(null),g=Mt(T=>T.size),m=Array.isArray(u)?[u[0],u[1]]:[u,u],B=[n.image.width,n.image.height],S=Math.max(g.width,g.height);return ve.useImperativeHandle(d,()=>p.current,[]),ve.useLayoutEffect(()=>{p.current.geometry.parameters&&p.current.material.scale.set(m[0]*p.current.geometry.parameters.width,m[1]*p.current.geometry.parameters.height)},[]),ve.createElement("mesh",dt({ref:p,scale:Array.isArray(u)?[...u,1]:u},c),ve.createElement("planeGeometry",{args:[1,1,h,h]}),ve.createElement("imageMaterial",{color:r,map:n,zoom:t,grayscale:e,opacity:a,scale:m,imageBounds:B,resolution:S,radius:o,toneMapped:i,transparent:s,side:f,key:Ln.key}),l)}),Yo=ve.forwardRef(({url:l,...r},h)=>{const u=Xr(l);return ve.createElement(ra,dt({},r,{texture:u,ref:h}))}),Ko=ve.forwardRef(({url:l,...r},h)=>ve.createElement(ra,dt({},r,{ref:h}))),Jo=ve.forwardRef((l,r)=>{if(l.url)return ve.createElement(Yo,dt({},l,{ref:r}));if(l.texture)return ve.createElement(Ko,dt({},l,{ref:r}));throw new Error("<Image /> requires a url or texture")});function Qo(l,r,h){return(1-h)*l+h*r}function ht(l,r,h,u){return Qo(l,r,1-Math.exp(-h*u))}function Zo(l){const{metadata:r}=l,{backgroundUrl:h,coverUrl:u}=r,{width:t,height:e}=Mt(n=>n.viewport),a=ve.useRef(null),o=h||u;return Vn(({clock:n},i)=>{a.current&&(a.current.position.x=ht(a.current.position.x,Math.sin(n.elapsedTime*.1)*t*.045,.7,i),a.current.position.y=ht(a.current.position.y,Math.sin(n.elapsedTime*.05)*e*.045,.7,i),a.current.material.opacity=ht(a.current.material.opacity,1,.7,i))}),o?_.jsx(fa,{getResetKey:()=>"reset",onCatch:n=>console.error(n),errorComponent:()=>_.jsx(_.Fragment,{}),children:_.jsx("group",{scale:1.1,children:_.jsx(Jo,{ref:a,renderOrder:1,url:o,scale:[t,e],transparent:!0,opacity:0})})}):null}function qo(l){const{description:r}=l,{ref:h,focused:u}=ua({focusKey:"game-description",onFocus:({node:t})=>{t!==document.activeElement&&(t==null||t.focus())},onBlur:({node:t})=>{t===document.activeElement&&(t==null||t.blur())}});return _.jsx(Xe,{id:"game-description",handlers:{UP:{handler:t=>{var e,a;((e=h.current)==null?void 0:e.scrollTop)!==0&&((a=h.current)==null||a.scrollBy({top:-100,behavior:"smooth"}),t==null||t.stopPropagation(),t==null||t.preventDefault())}},DOWN:{handler:t=>{var n;const{scrollTop:e,clientHeight:a,scrollHeight:o}=h.current??{};if(e!==void 0&&a!==void 0&&o!==void 0){if(e+a===o)return;(n=h.current)==null||n.scrollBy({top:100,behavior:"smooth"}),t==null||t.stopPropagation(),t==null||t.preventDefault()}}}},children:_.jsxs("div",{className:Ve("px-4 py-2 border-l border-secondary mx-auto","bg-transparent transition-all","[&_*]:outline-none","focus-hover:bg-muted/80 focus-hover:border-accent",u&&"bg-muted/80 border-accent"),children:[_.jsx("h3",{className:"text-3xl font-black uppercase mb-2",children:"Description"}),_.jsx(Zt,{ref:h,tabIndex:-1,type:u?"auto":"hover",className:Ve(),children:_.jsx("div",{children:_.jsx("p",{className:"text-lg text-muted-foreground max-w-[75ch]",children:r})})})]})})}function $o(){const{gameMetadata:l,game:r,platform:h,platformMetadata:u}=pt(),t=ve.useMemo(()=>{const n=l==null?void 0:l.minutesPlayed;if(n===void 0)return"Not played yet";if(n>60){const i=Math.floor(n/60),s=n%60;return`${i} hours ${s} minutes`}return`${n} minutes`},[l==null?void 0:l.minutesPlayed]),e=ve.useMemo(()=>{const n=l==null?void 0:l.lastPlayed;return n?yn(n).toLocaleString():"Not played yet"},[l==null?void 0:l.lastPlayed]),a=ve.useMemo(()=>{const n=r.createdAt;return n?yn(n).toLocaleString():""},[r.createdAt]),o=ve.useMemo(()=>typeof(u==null?void 0:u.name)=="string"?u.name:Pn(h.path)??"Unknown",[u,h.path]);return _.jsxs("div",{className:Ve("flex gap-8 py-8 justify-between *:basis-0","text-center border-secondary","outline-none focus:border-accent"),children:[_.jsx(Kt,{title:"Play Time",value:t}),_.jsx(Kt,{title:"Last Played",value:e}),_.jsx(Kt,{title:"Added On",value:a}),_.jsx(Kt,{title:"Platform",value:o})]})}function Kt(l){return _.jsxs("div",{className:"whitespace-nowrap",children:[_.jsx("h3",{className:"text-2xl font-bold uppercase",children:l.title}),_.jsx("p",{className:"text-muted-foreground",children:l.value})]})}function ei(){var t;const{extraMetadata:l}=pt(),r=(t=l==null?void 0:l.similarGames)==null?void 0:t.value,{data:h,status:u}=ca({request:{gameIds:r==null?void 0:r.map(e=>e.id)}});return _.jsxs("div",{className:Ve("w-full bg-transparent border-l border-secondary pt-2","focus-within:bg-muted/80 focus-within:border-accent","hover:bg-muted/80 hover:border-accent transition-all"),children:[_.jsx("h3",{className:"text-3xl uppercase font-black ml-4",children:"Similar Games"}),_.jsxs(Zt,{className:"w-full",children:[_.jsx(Et,{opts:{focusKey:"similar-games"},className:Ve("flex gap-2 p-4","[&_p]:text-muted-foreground [&_p]:my-6 [&_p]:flex [&_p]:gap-2 [&_p]:mx-auto"),children:u==="pending"?_.jsxs("p",{className:"text-muted-foreground",children:[_.jsx(In,{className:"animate-spin"}),"Loading similar games..."]}):u==="error"?_.jsxs("p",{className:"text-muted-foreground",children:[_.jsx(ha,{className:"text-destructive-text"}),"Error loading similar games"]}):h.metadata.length===0?_.jsx(Je,{opts:{focusKey:"empty-similar-games",onFocus:({node:e})=>{e==null||e.focus({preventScroll:!0}),e==null||e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},children:_.jsx("p",{tabIndex:-1,className:"outline-none",children:"No similar games found for this game."})}):h.metadata.slice(0,20).map(e=>_.jsx(ti,{metadata:e},e.gameId))}),_.jsx(da,{orientation:"horizontal"})]})]})}function ti(l){const{metadata:r}=l,h=Er(),u=()=>{h({to:"/fullscreen/games/$gameId",resetScroll:!1,params:{gameId:r.gameId.toString()}})};return _.jsx(Xe,{handlers:{ACCEPT:{handler:()=>u()}},children:_.jsx(Je,{opts:{focusKey:`similar-game-${r.gameId}`,onFocus:({node:t})=>{t==null||t.focus({preventScroll:!0}),t==null||t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},children:_.jsx("div",{tabIndex:-1,className:Ve("focus:ring-2 focus:ring-offset-2 focus:ring-offset-ring focus:ring-ring min-w-[150px] max-w-[200px]","outline-none scale-95 transition-all duration-200 focus-hover:scale-100 cursor-pointer"),onClick:()=>u(),children:_.jsx("img",{src:r.coverUrl,alt:""})})})})}function ri(){const[l,r]=ve.useState(!1),{game:h}=pt(),{data:u}=jn(h),{mutate:t,status:e}=va(h),a=u!==kr.INSTALLED,o=e==="pending"||u!==kr.INSTALLED;return _.jsxs(Mr,{open:l,onOpenChange:r,children:[_.jsx(Gr,{asChild:!0,children:_.jsx(Je,{opts:{focusKey:"uninstall-game-action-open",focusable:!a},children:_.jsx(Nn,{disabled:a,children:"Uninstall Game"})})}),_.jsx(Rr,{onCloseAutoFocus:n=>{n.preventDefault(),n.stopPropagation()},children:_.jsx(Xe,{allowBubbling:"never",handlers:{BACK:{handler:()=>r(!1)},MENU:{handler:()=>t()}},children:_.jsxs(Et,{opts:{focusKey:"uninstall-game-action",isFocusBoundary:!0},children:[_.jsxs(Br,{children:[_.jsx(Or,{children:"Uninstall Game"}),_.jsx(Lr,{children:"Are you sure you want to uninstall this game?"})]}),_.jsx(Je,{initialFocus:!0,opts:{focusKey:"uninstall-game-action-trap"},children:_.jsx("button",{className:"opacity-0"})}),_.jsxs(Pr,{children:[_.jsx(Ir,{asChild:!0,children:_.jsx(Dt,{hotkey:"BACK",children:"Back"})}),_.jsx(Dt,{disabled:o,hotkey:"MENU",onClick:()=>t(),children:e==="pending"?_.jsx(In,{className:"animate-spin"}):"Confirm"})]})]})})})]})}function ni(){const{game:l}=pt(),r=Er(),[h,u]=ve.useState(!1),[t,e]=ve.useState(!1),[a,o]=ve.useState(!1),{mutate:n}=pa(),i=ve.useCallback(()=>(n({ids:[l.id],deleteFromDisk:t===!0,blacklistEntries:a===!0}),r({to:"/fullscreen"})),[l,t,n,a,r]);return _.jsxs(Mr,{open:h,onOpenChange:u,children:[_.jsx(Gr,{asChild:!0,children:_.jsx(Je,{opts:{focusKey:"delete-game-action-open"},children:_.jsx(Nn,{children:"Delete Game"})})}),_.jsx(Rr,{children:_.jsx(Xe,{zones:{gameActions:!1},handlers:{BACK:{handler:()=>u(!1),zone:"deleteGameAction"},MENU:{handler:i,zone:"deleteGameAction"}},children:_.jsxs(Et,{initialFocus:!0,opts:{focusKey:"delete-game-action"},children:[_.jsxs(Br,{children:[_.jsx(Or,{children:"Delete Game"}),_.jsx(Lr,{children:"Are you sure you want to delete this game?"})]}),_.jsx(Zt,{className:"h-full w-full",children:_.jsxs("div",{className:"flex flex-col h-full gap-6",children:[_.jsxs("div",{className:"flex gap-2 text-sm bg-muted px-2 py-3 rounded",children:[_.jsx(ga,{className:"text-accent-text min-w-[1rem] h-[1rem] w-[1rem]",size:36}),_.jsxs("div",{className:"flex flex-col gap-2",children:[_.jsx("p",{children:"You can either delete the entry from the database or delete the game from the disk."}),_.jsx("p",{children:"Deleting only the entry will leave your file system as is, but Retrom will ignore the game's directory moving forward."})]})]}),_.jsx(xn,{label:"Delete from disk",checked:t,onCheckedChange:e,children:_.jsx("p",{className:"text-sm text-muted-foreground",children:"This will alter the filesystem"})}),_.jsx(xn,{label:"Blacklist Entries",checked:a,onCheckedChange:o,children:_.jsx("p",{className:"text-sm text-muted-foreground",children:"Enabling this will prevent the game and its files from being re-imported in any future library scans"})})]})}),_.jsxs(Pr,{children:[_.jsx(Ir,{asChild:!0,children:_.jsx(Dt,{hotkey:"BACK",children:"Cancel"})}),_.jsx(Dt,{hotkey:"MENU",onClick:i,children:"Delete"})]})]})})})]})}function ai(){const[l,r]=ve.useState(!1);return ma({handlers:{PAGE_LEFT:{handler:()=>r(!0),zone:"gameActionsOpen"}}}),_.jsxs(Mr,{open:l,onOpenChange:r,children:[_.jsx(Xe,{id:"game-actions",handlers:{ACCEPT:{handler:()=>r(!0)}},children:_.jsx(Gr,{asChild:!0,children:_.jsx(Je,{opts:{focusKey:"game-actions-open"},children:_.jsx(ya,{variant:"accent",className:Ve("h-full rounded-none px-2 focus:ring-2 focus:ring-ring","opacity-80 focus-hover:opacity-100 transition-all"),children:_.jsx(xa,{size:28})})})})}),_.jsx(Rr,{children:_.jsx(Xe,{id:"game-actions",allowBubbling:"never",handlers:{BACK:{handler:()=>r(!1),zone:"gameActions"}},children:_.jsxs(Et,{initialFocus:!0,opts:{focusKey:"game-actions",isFocusBoundary:!0,forceFocus:!0},children:[_.jsxs(Br,{children:[_.jsx(Or,{children:"Game Actions"}),_.jsx(Lr,{children:"Perform actions on this game entry"})]}),_.jsxs("div",{className:"flex flex-col gap-2 h-full",children:[_.jsx(ba,{children:_.jsx(ri,{})}),_.jsx(ni,{})]}),_.jsx(Pr,{children:_.jsx(Ir,{asChild:!0,children:_.jsx(Dt,{hotkey:"BACK",children:"close"})})})]})})})]})}const at=new Wn;function oi(l){const r=ve.useRef(null),{width:h,height:u}=Mt(a=>a.viewport),[t,e]=ve.useMemo(()=>{const a=[];let o="";if(l.name!==void 0)for(const s of l.name.split(" ").reverse())o.length>15&&(a.push(o),o=""),o=s+" "+o;a.push(o.trim());const n=a.length;return[a.reverse().join(`
`).trim().toUpperCase(),n]},[l.name]);return Vn((a,o)=>{var c,d;if(!r.current)return;at.setFromObject(r.current);let n=((c=at==null?void 0:at.min)==null?void 0:c.x)??0,i=((d=at==null?void 0:at.max)==null?void 0:d.x)??0;[n,i].some(p=>[1/0,-1/0].includes(p))&&(n=0,i=1);const s=Math.abs(i-n),f=(s<h?s/h:-h/s)*.15;if(Math.abs(s-h)>.03*h)r.current.scale.y=1,r.current.fillOpacity=-1,r.current.outlineOpacity=-1.5,r.current.scale.addScalar(f);else{const p=t.length<7?3:e>1?1.25:2;r.current.scale.y=ht(r.current.scale.y,p,1,o),r.current.fillOpacity=ht(r.current.fillOpacity??0,1,.7,o),r.current.outlineOpacity=ht(r.current.outlineOpacity??-1.5,.5,.7,o)}}),_.jsxs(Vo,{ref:r,fontSize:1,lineHeight:.85,fontWeight:900,textAlign:"center",anchorY:"bottom-baseline",anchorX:"center","rotation-x":-.55,position:[0,-u/2,0],scale:[1,1,1],renderOrder:2,outlineColor:"black",outlineBlur:.075,outlineOpacity:-1.5,fillOpacity:-1,children:[_.jsx("meshBasicMaterial",{color:"#fff",toneMapped:!1,transparent:!0,depthTest:!1}),t]})}const ii=Ua("/_fullscreenLayout/fullscreen/games/$gameId")({component:si});function si(){const{gameId:l}=ii.useParams(),r=parseInt(l,10);return _.jsx(Sa,{gameId:r,errorRedirectUrl:"/fullscreen",children:_.jsx(li,{})})}const Yr=Ve(wa({variant:"accent",size:"lg"}),"font-bold w-auto text-5xl h-[unset] [&_svg]:hidden uppercase px-8 py-4","focus:ring-2 focus:ring-ring focus:ring-offset-2","opacity-80 focus-hover:opacity-100 transition-all h-full rounded-none");function Kr(l){l.target.scrollIntoView({block:"end"})}function li(){const{gameMetadata:l,game:r}=pt(),{data:h}=jn(r),u=Er(),t=(l==null?void 0:l.name)||Pn(r.path);return _.jsx(Xe,{id:"game-page",handlers:{BACK:{handler:()=>u({to:"/fullscreen",resetScroll:!1})}},children:_.jsx(Zt,{className:"h-full w-full",children:_.jsx(Et,{opts:{focusKey:"game-details",forceFocus:!0},className:"flex-grow flex justify-center items-center w-full animate-in fade-in pb-32",children:_.jsx("div",{className:Ve("flex flex-col w-full h-full relative"),children:_.jsxs("div",{className:Ve("relative min-h-full w-full","grid grid-rows-[1fr_auto_auto_auto]","*:col-start-1 *:col-end-1"),children:[_.jsxs("div",{className:"relative h-[75dvh] row-start-1 row-end-3 -z-[1] overflow-hidden",children:[_.jsxs(Ya,{children:[l&&_.jsx(Zo,{metadata:l}),_.jsx(oi,{name:t})]}),_.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background to-20% to-background/0"})]}),_.jsxs("div",{className:"row-start-2 row-end-4 flex justify-center gap-1",children:[_.jsx("div",{className:"w-min",children:_.jsx(_a,{desktop:h===kr.INSTALLED?_.jsx(fi,{}):_.jsx(ui,{}),web:_.jsx(ci,{})})}),!r.thirdParty&&_.jsx(ai,{})]}),_.jsxs("div",{className:"row-start-4 my-8 flex flex-col gap-12 w-max max-w-[85ch] mx-auto items-stretch",children:[_.jsx($o,{}),_.jsx(qo,{description:(l==null?void 0:l.description)||""}),_.jsx(ei,{})]})]})})})})})}const fi=ve.memo(()=>{const l=ve.useRef(null);return _.jsx(Xe,{id:"play-button",handlers:{ACCEPT:{handler:()=>{var r;return(r=l.current)==null?void 0:r.click()}}},children:_.jsx(Je,{ref:l,initialFocus:!0,opts:{focusKey:"fullscreen-play-button",onFocus:({node:r})=>{r==null||r.focus({preventScroll:!0})}},children:_.jsx(ka,{onFocus:Kr,className:Yr})})})}),ui=ve.memo(()=>{const l=ve.useRef(null);return _.jsx(Xe,{id:"install-button",handlers:{ACCEPT:{handler:()=>{var r;return(r=l.current)==null?void 0:r.click()}}},children:_.jsx(Je,{ref:l,initialFocus:!0,opts:{focusKey:"fullscreen-install-button",onFocus:({node:r})=>{r==null||r.focus({preventScroll:!0})}},children:_.jsx(Ta,{onFocus:Kr,className:Ve(Yr,'[&_div[role="progressbar"]]:w-[6ch] [&_div[role="progressbar"]_>_*]:bg-primary-foreground')})})})});function ci(){const l=ve.useRef(null),{game:r}=pt();return _.jsx(Xe,{id:"download-button",handlers:{ACCEPT:{handler:()=>{var h;return(h=l.current)==null?void 0:h.click()}}},children:_.jsx(Je,{ref:l,initialFocus:!0,opts:{focusKey:"fullscreen-download-button",onFocus:({node:h})=>{h==null||h.focus({preventScroll:!0})}},children:_.jsx(Fa,{onFocus:Kr,game:r,className:Yr})})})}export{ii as Route};
